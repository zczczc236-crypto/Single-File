<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mythic Overlord: World Championship</title>
    <style>
        :root {
            --ssr: #ffcc00; --sr: #c154ff; --r: #00d2ff; --mythic: #ff4757;
            --gold: #ffd700; --dia: #00f2ff; --bg: #05050a;
        }

        body { margin: 0; background: var(--bg); color: white; font-family: 'Pretendard', sans-serif; display: flex; justify-content: center; height: 100vh; overflow: hidden; }
        #app { width: 100%; max-width: 480px; display: flex; flex-direction: column; background: radial-gradient(circle at top, #1a1a2e 0%, #05050a 100%); position: relative; height: 100%; box-shadow: 0 0 50px rgba(0,242,255,0.3); }

        /* ë¡œê·¸ì¸ & ë ˆì´ì–´ */
        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px; }
        .auth-input { width: 100%; padding: 15px; margin-bottom: 10px; background: #111; border: 1px solid #333; color: white; border-radius: 12px; box-sizing: border-box; }

        /* ìƒíƒœë°” */
        .status-bar { padding: 15px; background: rgba(0, 0, 0, 0.9); display: grid; grid-template-columns: 1fr 1fr; gap: 8px; border-bottom: 2px solid #333; flex-shrink: 0; z-index: 100; }
        .stat-card { background: rgba(255,255,255,0.05); padding: 8px; border-radius: 12px; font-size: 0.85rem; font-weight: bold; text-align: center; border: 1px solid #444; }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; scrollbar-width: none; }
        .content::-webkit-scrollbar { display: none; }

        /* ì „íˆ¬/í‚¹ ë°°ê²½ */
        .battle-view { background: rgba(255,255,255,0.03); border: 2px solid #444; border-radius: 24px; padding: 20px; text-align: center; margin-bottom: 20px; transition: 0.1s; position: relative; }
        .king-mode { border-color: var(--gold); box-shadow: 0 0 20px var(--gold); background: linear-gradient(to bottom, rgba(255,215,0,0.1), transparent); }
        .monster-img { font-size: 5rem; height: 130px; display: flex; align-items: center; justify-content: center; transition: 0.1s; }
        .hp-bar { height: 14px; background: #222; border-radius: 7px; overflow: hidden; border: 1px solid #555; margin: 15px 0; }
        .hp-fill { height: 100%; background: linear-gradient(90deg, #ff4757, #ff6b81); width: 100%; transition: 0.1s; }

        /* ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ */
        .item-row { display: flex; align-items: center; background: rgba(255,255,255,0.05); margin-bottom: 10px; padding: 12px; border-radius: 15px; border: 1px solid #333; }
        .item-info { flex: 1; }
        .grade-tag { font-size: 0.6rem; font-weight: 900; padding: 2px 6px; border-radius: 4px; margin-right: 5px; }

        /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .nav { position: absolute; bottom: 0; width: 100%; height: 80px; display: flex; background: #0a0a0f; border-top: 2px solid #333; z-index: 200; }
        .nav-btn { flex: 1; border: none; background: none; color: #555; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold; }
        .nav-btn.active { color: var(--dia); }
        .nav-btn span { font-size: 1.5rem; margin-bottom: 4px; }

        /* ë²„íŠ¼ */
        .btn { border: none; border-radius: 12px; cursor: pointer; font-weight: bold; color: white; transition: 0.2s; outline: none; }
        .btn-p { background: linear-gradient(135deg, #ff416c, #ff4b2b); width: 100%; padding: 16px; font-size: 1rem; box-shadow: 0 4px 15px rgba(255,65,108,0.3); }
        .btn-s { background: var(--gold); color: black; padding: 8px 14px; font-size: 0.8rem; }
        .btn-king { background: var(--gold); color: black; width: 100%; padding: 10px; margin-top: 10px; font-size: 0.9rem; display: none; }

        .hidden { display: none; }
        #toast { position: fixed; top: 15%; left: 50%; transform: translateX(-50%); background: var(--ssr); color: #000; padding: 12px 30px; border-radius: 30px; font-weight: bold; z-index: 2000; opacity: 0; transition: 0.3s; pointer-events: none; }
        .shake { animation: shake 0.1s ease-in-out; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
    </style>
</head>
<body>

<div id="toast">ì•Œë¦¼</div>

<div id="auth-screen" class="overlay">
    <h1 style="color:var(--dia); letter-spacing: 2px;">OVERLORD</h1>
    <p style="color:#666; font-size:0.8rem; margin-bottom:30px;">ë‹¹ì‹ ì˜ ì „ì„¤ì„ ê¸°ë¡í•˜ì„¸ìš”</p>
    <input type="text" id="user-id" class="auth-input" placeholder="ê³„ì • ì•„ì´ë””">
    <input type="password" id="user-pw" class="auth-input" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button class="btn btn-p" onclick="handleAuth()">ì‹œì‘í•˜ê¸°</button>
</div>

<div id="app" class="hidden">
    <div class="status-bar">
        <div class="stat-card" style="color:var(--dia)">ğŸ’ <span id="val-dia">0</span></div>
        <div class="stat-card" style="color:var(--gold)">ğŸ’° <span id="val-gold">0</span></div>
    </div>

    <div class="content">
        <div id="tab-battle">
            <div class="battle-view" id="battle-area">
                <div id="king-tag" style="font-size: 0.7rem; color: var(--gold); font-weight: bold; display:none;">ğŸ‘‘ KING'S DOMAIN ğŸ‘‘</div>
                <div style="font-weight:bold; color:var(--ssr)">STAGE <span id="cur-stage">1</span></div>
                <div class="monster-img" id="monster-icon">ğŸ‰</div>
                <div class="hp-bar"><div id="hp-fill" class="hp-fill"></div></div>
                <div style="font-size:0.8rem; color:#aaa; margin-bottom:12px;">ê³µê²©ë ¥: <span id="val-dps">0</span></div>
                <button class="btn btn-p" onclick="manualHit()">ê³µê²©</button>
                <button id="btn-king-skill" class="btn btn-king" onclick="kingSkill()">ğŸ‘‘ ì™•ì˜ ìœ„ì—„ (ë°ë¯¸ì§€ 10ë°°)</button>
            </div>
            <h4>ğŸº ìœ ë¬¼ ë³´ê´€ì†Œ</h4>
            <div id="arti-list" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;"></div>
        </div>

        <div id="tab-draw" class="hidden">
            <h3 style="text-align:center;">ğŸ”® ì°¨ì›ì˜ ë¬¸</h3>
            <div id="draw-area" style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px;"></div>
            <button class="btn btn-p" onclick="summon(10)">10íšŒ ì—°ì† ì†Œí™˜ (1,000ğŸ’)</button>
        </div>

        <div id="tab-shop" class="hidden">
            <h3 style="text-align:center;">ğŸ›’ ì œêµ­ ì•”ì‹œì¥</h3>
            <div class="item-row" style="background:rgba(0,242,255,0.05); border:1px solid var(--dia)">
                <div class="item-info"><b>ğŸ’ ë‹¤ì´ì•„ í™˜ì „</b><br><small>8,000ğŸ’° â” 100ğŸ’</small></div>
                <button class="btn btn-s" onclick="exchangeDia()">í™˜ì „</button>
            </div>
            <div class="item-row"><div class="item-info"><b>ğŸ–±ï¸ ì˜¤í†  í´ë¦­ì»¤</b><br><small>30ì´ˆê°„ ì´ˆë‹¹ 10íšŒ ìë™ ê³µê²©</small></div><button class="btn btn-s" onclick="buyItem('auto', 3000)">3,000ğŸ’°</button></div>
            <div class="item-row"><div class="item-info"><b>ğŸ›¡ï¸ ì œë ¨ ë³´í˜¸ì„</b><br><small>ê°•í™” ì‹¤íŒ¨ ì‹œ ë“±ê¸‰ í•˜ë½ ë°©ì§€</small></div><button class="btn btn-s" onclick="buyItem('prot', 15000)">15,000ğŸ’°</button></div>
        </div>

        <div id="tab-social" class="hidden">
            <h3 style="text-align:center;">ğŸ† ì‹¤ì‹œê°„ ë­í‚¹</h3>
            <div id="rank-list" class="battle-view" style="text-align:left; padding:10px;"></div>
            
            <h3 style="text-align:center;">âš”ï¸ ì•½íƒˆ ëŒ€ê²°</h3>
            <div class="item-row">
                <input type="text" id="search-id" placeholder="ìœ ì € ID ê²€ìƒ‰" style="flex:1; background:none; border:none; color:white; outline:none;">
                <button class="btn btn-s" style="background:var(--mythic); color:white;" onclick="pvp()">ì•½íƒˆ</button>
            </div>
            <div id="pvp-res" style="text-align:center; font-size:0.85rem; color:var(--dia)"></div>
        </div>

        <div id="tab-manage" class="hidden">
            <div class="battle-view" style="padding:15px;">
                <b>ğŸ”¨ ì „ì„¤ ì œë ¨ì†Œ (+<span id="val-wp">0</span>)</b><br>
                <button class="btn btn-s" style="width:100%; margin-top:10px;" onclick="upgrade()">ì œë ¨ ì‹œë„ (2,000ğŸ’°)</button>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h4>âš”ï¸ ë³´ìœ  êµ°ë‹¨</h4>
                <button class="btn btn-s" style="background:var(--sr); color:white;" onclick="allEvolve()">ì¼ê´„ í•©ì„±</button>
            </div>
            <div id="inv-list"></div>
        </div>
    </div>

    <nav class="nav">
        <button class="nav-btn active" onclick="nav('battle')"><span>âš”ï¸</span>ì „íˆ¬</button>
        <button class="nav-btn" onclick="nav('draw')"><span>ğŸ”®</span>ì†Œí™˜</button>
        <button class="nav-btn" onclick="nav('shop')"><span>ğŸ›’</span>ìƒì </button>
        <button class="nav-btn" onclick="nav('social')"><span>ğŸ†</span>ì†Œì…œ</button>
        <button class="nav-btn" onclick="nav('manage')"><span>ğŸ‘¤</span>ê´€ë¦¬</button>
    </nav>
</div>

<script>
    /* --- ì‹œìŠ¤í…œ ë°ì´í„° --- */
    let currentUser = "";
    let game = {};
    let buffs = { auto: 0, king: 0 };
    const HERO_DB = [];
    for(let i=1; i<=40; i++) {
        let g = i > 35 ? "MYTHIC" : (i > 25 ? "SSR" : "SR");
        HERO_DB.push({ id: i, name: `ìš©ì‚¬ ${i}`, grade: g, atk: i*70 + (i > 25 ? 4000 : 400), price: 1000 + (i*150) });
    }
    const ARTI_DB = [
        { id: 1, name: "ì‹¬íŒì˜ ê²€", desc: "ê³µê²©ë ¥ ì¦ê°€", icon: "ğŸ—¡ï¸" },
        { id: 2, name: "íƒìš•ì˜ ì”", desc: "ê³¨ë“œ ë³´ë„ˆìŠ¤", icon: "ğŸ·" },
        { id: 3, name: "ì°¨ì›ì˜ ì—´ì‡ ", desc: "ë‹¤ì´ì•„ ë“œë", icon: "ğŸ”‘" }
    ];

    /* --- ì¸ì¦ ë° ì €ì¥ --- */
    function handleAuth() {
        const id = document.getElementById('user-id').value.trim();
        const pw = document.getElementById('user-pw').value.trim();
        if(!id || !pw) return alert("ì•„ì´ë””/ë¹„ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”!");

        const users = JSON.parse(localStorage.getItem('final_overlord_users') || "{}");
        if(users[id]) {
            if(users[id].pw !== pw) return alert("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜!");
            game = users[id].data;
        } else {
            game = { dia: 3000, gold: 0, wp: 0, stage: 1, inv: [], artis: {1:0, 2:0, 3:0}, prot: 0, mHp: 2000, maxHp: 2000 };
            users[id] = { pw: pw, data: game };
            localStorage.setItem('final_overlord_users', JSON.stringify(users));
        }
        currentUser = id;
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        updateUI(); updateMonster();
    }

    function save() {
        if(!currentUser) return;
        const users = JSON.parse(localStorage.getItem('final_overlord_users') || "{}");
        users[currentUser].data = game;
        localStorage.setItem('final_overlord_users', JSON.stringify(users));
    }

    /* --- ê²Œì„ í”Œë ˆì´ --- */
    function calcAtk(targetInv = game.inv, targetWp = game.wp, targetArtis = game.artis) {
        let base = targetInv.reduce((s, h) => s + (h.atk * (h.star || 1)), 0);
        let bonus = 1 + (targetArtis[1] * 0.25);
        let total = (base + (targetWp * 700) + 30) * bonus;
        return buffs.king > 0 ? total * 10 : total;
    }

    function manualHit() {
        document.getElementById('battle-area').classList.add('shake');
        setTimeout(() => document.getElementById('battle-area').classList.remove('shake'), 100);
        hit(calcAtk());
    }

    function hit(d) {
        game.mHp -= d;
        if(game.mHp <= 0) {
            let gBonus = 1 + (game.artis[2] * 0.4);
            game.gold += Math.floor((500 + (game.stage * 180)) * gBonus);
            
            let dChance = 0.2 + (game.artis[3] * 0.08);
            if(Math.random() < dChance) game.dia += 30;

            if(game.stage % 10 === 0) {
                let r = Math.floor(Math.random()*3)+1;
                game.artis[r]++;
                msg(`ğŸº ìœ ë¬¼ ê°•í™”! [${ARTI_DB[r-1].name}] Lv.${game.artis[r]}`);
            }

            game.stage++;
            game.maxHp = Math.floor(2000 * Math.pow(1.35, game.stage-1));
            game.mHp = game.maxHp;
            updateMonster();
        }
        updateUI(); save();
    }

    setInterval(() => {
        hit(calcAtk() / 10);
        if(buffs.auto > 0) { hit(calcAtk() / 2); buffs.auto -= 0.1; }
        if(buffs.king > 0) buffs.king -= 0.1;
    }, 100);

    /* --- ìƒì  & ë­í‚¹ --- */
    function exchangeDia() {
        if(game.gold < 8000) return msg("ê³¨ë“œ ë¶€ì¡±!");
        game.gold -= 8000; game.dia += 100; updateUI(); save();
    }

    function buyItem(t, p) {
        if(game.gold < p) return msg("ê³¨ë“œ ë¶€ì¡±!");
        game.gold -= p;
        if(t==='auto') buffs.auto = 30;
        if(t==='prot') game.prot++;
        msg("êµ¬ë§¤ ì„±ê³µ!"); updateUI(); save();
    }

    function pvp() {
        const sid = document.getElementById('search-id').value.trim();
        const users = JSON.parse(localStorage.getItem('final_overlord_users') || "{}");
        if(!users[sid] || sid === currentUser) return msg("ìœ íš¨í•˜ì§€ ì•Šì€ ëŒ€ìƒ!");

        let myP = calcAtk();
        let opP = calcAtk(users[sid].data.inv, users[sid].data.wp, users[sid].data.artis);

        if(myP > opP) {
            let steal = Math.floor(users[sid].data.gold * 0.15); // 15% ì•½íƒˆ
            game.gold += steal;
            users[sid].data.gold -= steal;
            localStorage.setItem('final_overlord_users', JSON.stringify(users));
            document.getElementById('pvp-res').innerHTML = `âš”ï¸ <b style="color:var(--dia)">ìŠ¹ë¦¬!</b> ${sid}ë¡œë¶€í„° ${steal.toLocaleString()}ğŸ’° ì•½íƒˆ!`;
        } else {
            document.getElementById('pvp-res').innerHTML = `ğŸ’€ <b style="color:var(--mythic)">íŒ¨ë°°...</b> ì „íˆ¬ë ¥ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.`;
        }
        updateUI(); save();
    }

    /* --- í‚¹ ëª¨ë“œ ìŠ¤í‚¬ --- */
    function kingSkill() {
        if(buffs.king > 0) return;
        buffs.king = 10;
        msg("ğŸ‘‘ ì™•ì˜ ìœ„ì—„ ë°œë™! 10ì´ˆê°„ ë°ë¯¸ì§€ 10ë°°!");
    }

    /* --- ê´€ë¦¬ ë° í•©ì„± --- */
    function summon(n) {
        if(game.dia < 1000) return msg("ë‹¤ì´ì•„ ë¶€ì¡±!");
        game.dia -= 1000;
        const area = document.getElementById('draw-area'); area.innerHTML = '';
        for(let i=0; i<n; i++) {
            let pick = HERO_DB[Math.floor(Math.random()*HERO_DB.length)];
            game.inv.push({...pick, uid: Date.now()+Math.random(), star:1});
            area.innerHTML += `<div style="background:#222; padding:5px; border-radius:8px; font-size:0.6rem; border:1px solid var(--${pick.grade.toLowerCase()}); text-align:center;">${pick.name}</div>`;
        }
        updateUI(); save();
    }

    function sellHero(uid) {
        let idx = game.inv.findIndex(h => h.uid === uid);
        let h = game.inv[idx];
        game.gold += h.price;
        let pb = h.grade === "MYTHIC" ? 200 : (h.grade === "SSR" ? 50 : 0);
        if(pb > 0) { game.dia += pb; msg(`ë“±ê¸‰ í™˜ê¸‰! ${pb}ğŸ’ ë³´ë„ˆìŠ¤`); }
        game.inv.splice(idx, 1);
        renderInv(); updateUI(); save();
    }

    function allEvolve() {
        let counts = {};
        game.inv.forEach(h => counts[h.id] = (counts[h.id] || 0) + 1);
        for(let id in counts) {
            if(counts[id] >= 2) {
                let idNum = parseInt(id);
                game.inv.splice(game.inv.findIndex(h => h.id === idNum), 1);
                let i2 = game.inv.findIndex(h => h.id === idNum);
                game.inv[i2].star++;
                game.inv[i2].atk *= 2;
                msg(`${game.inv[i2].name} í•©ì„± ì„±ê³µ!`);
                break;
            }
        }
        renderInv(); updateUI(); save();
    }

    function upgrade() {
        if(game.gold < 2000) return;
        game.gold -= 2000;
        if(Math.random() < 0.3) { game.wp++; msg("ì œë ¨ ì„±ê³µ!"); }
        else { if(game.prot > 0) { game.prot--; msg("ë³´í˜¸ì„ ì‚¬ìš©!"); } else game.wp = Math.max(0, game.wp-1); }
        updateUI(); save();
    }

    /* --- UI ë Œë”ë§ --- */
    function nav(t) {
        document.querySelectorAll('.content > div').forEach(d => d.classList.add('hidden'));
        document.getElementById('tab-' + t).classList.remove('hidden');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        event.currentTarget.classList.add('active');
        if(t === 'manage') renderInv();
        if(t === 'social') updateRank();
        if(t === 'battle') renderArtis();
    }

    function updateRank() {
        const users = JSON.parse(localStorage.getItem('final_overlord_users') || "{}");
        let list = Object.keys(users).map(id => ({ id, stage: users[id].data.stage }));
        list.sort((a, b) => b.stage - a.stage);
        
        const rankList = document.getElementById('rank-list');
        rankList.innerHTML = list.slice(0, 10).map((u, i) => `
            <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #333; ${u.id===currentUser?'color:var(--dia)':''}">
                <span>${i===0?'ğŸ‘‘':'<b>'+(i+1)+'</b>.'} ${u.id} ${i===0?'[KING]':''}</span>
                <span>Stage ${u.stage}</span>
            </div>
        `).join('');

        // ë­í‚¹ 1ìœ„ ì²´í¬
        const isKing = (list.length > 0 && list[0].id === currentUser);
        const bView = document.getElementById('battle-area');
        const kTag = document.getElementById('king-tag');
        const kBtn = document.getElementById('btn-king-skill');
        
        if(isKing) {
            bView.classList.add('king-mode');
            kTag.style.display = 'block';
            kBtn.style.display = 'block';
        } else {
            bView.classList.remove('king-mode');
            kTag.style.display = 'none';
            kBtn.style.display = 'none';
        }
    }

    function renderArtis() {
        const area = document.getElementById('arti-list'); area.innerHTML = '';
        ARTI_DB.forEach(a => {
            area.innerHTML += `<div style="background:#111; padding:10px; border-radius:12px; border:1px solid #333; text-align:center;">
                <div style="font-size:1.5rem;">${a.icon}</div>
                <b style="font-size:0.7rem;">Lv.${game.artis[a.id]}</b><br>
                <small style="font-size:0.5rem; color:#888;">${a.desc}</small>
            </div>`;
        });
    }

    function renderInv() {
        const list = document.getElementById('inv-list'); list.innerHTML = '';
        game.inv.forEach(h => {
            list.innerHTML += `<div class="item-row">
                <div class="item-info">
                    <span class="grade-tag" style="background:var(--${h.grade.toLowerCase()}); color:black;">${h.grade}</span>
                    <b>${h.name} â˜…${h.star}</b>
                </div>
                <button class="btn btn-s" style="margin-right:5px;" onclick="sellHero(${h.uid})">íŒë§¤</button>
                <button class="btn btn-s" style="background:var(--sr); color:white;" onclick="allEvolve()">í•©ì„±</button>
            </div>`;
        });
    }

    function msg(m) { const t = document.getElementById('toast'); t.innerText = m; t.style.opacity = 1; setTimeout(() => t.style.opacity = 0, 1500); }
    function updateMonster() { document.getElementById('monster-icon').innerText = ["ğŸ‰", "ğŸ§™", "ğŸ§›", "ğŸ§Ÿ", "ğŸ‘¾", "ğŸ¦–"][game.stage % 6]; }
    function updateUI() {
        document.getElementById('val-dia').innerText = game.dia.toLocaleString();
        document.getElementById('val-gold').innerText = game.gold.toLocaleString();
        document.getElementById('hp-fill').style.width = (game.mHp / game.maxHp * 100) + '%';
        document.getElementById('cur-stage').innerText = game.stage;
        document.getElementById('val-dps').innerText = Math.floor(calcAtk()).toLocaleString();
        document.getElementById('val-wp').innerText = game.wp;
    }
</script>
</body>
</html>
