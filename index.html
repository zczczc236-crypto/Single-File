<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mythic Gacha: Empire Ultimate</title>
    <style>
        :root {
            --ssr: #ffcc00; --sr: #c154ff; --r: #00d2ff; --mythic: #ff4757;
            --gold: #ffd700; --dia: #00f2ff; --bg: #05050a;
        }

        body {
            margin: 0; background: var(--bg); color: white;
            font-family: 'Pretendard', sans-serif;
            display: flex; justify-content: center; height: 100vh; overflow: hidden;
        }

        #app {
            width: 100%; max-width: 480px; display: flex; flex-direction: column;
            background: radial-gradient(circle at top, #1a1a2e 0%, #05050a 100%);
            position: relative; box-shadow: 0 0 100px #000; height: 100%;
        }

        /* ìƒíƒœë°” */
        .status-bar {
            padding: 15px; background: rgba(0, 0, 0, 0.9);
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
            border-bottom: 2px solid #333; z-index: 100;
        }
        .stat-card { background: rgba(255,255,255,0.05); padding: 8px; border-radius: 12px; font-size: 0.85rem; font-weight: bold; text-align: center; border: 1px solid #444; }

        /* ì»¨í…ì¸  */
        .content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 120px; scrollbar-width: none; }
        .content::-webkit-scrollbar { display: none; }

        /* ì „íˆ¬ ì‹œìŠ¤í…œ */
        .battle-view {
            background: rgba(0,0,0,0.6); border: 2px solid #444; border-radius: 24px;
            padding: 20px; text-align: center; position: relative; overflow: hidden; margin-bottom: 15px;
            transition: 0.3s;
        }
        .monster-box { height: 150px; display: flex; align-items: center; justify-content: center; position: relative; }
        .monster-img { font-size: 5.5rem; transition: 0.1s; }
        .hp-bar { height: 12px; background: #222; border-radius: 6px; overflow: hidden; border: 1px solid #555; margin: 10px 0; }
        .hp-fill { height: 100%; background: linear-gradient(90deg, #ff4757, #ff6b81); width: 100%; transition: 0.1s; }

        /* ë°ë¯¸ì§€ í…ìŠ¤íŠ¸ */
        .floating-text {
            position: absolute; font-weight: 900; pointer-events: none;
            animation: floatUp 0.8s ease-out forwards; z-index: 50; text-shadow: 1px 1px 2px #000;
        }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-100px); opacity: 0; } }

        /* ìƒì /ìœ ë¬¼ ë¦¬ìŠ¤íŠ¸ */
        .item-row {
            display: flex; align-items: center; background: rgba(255,255,255,0.05);
            margin-bottom: 10px; padding: 12px; border-radius: 15px; border: 1px solid #333;
        }
        .item-icon { font-size: 1.8rem; margin-right: 15px; }
        .item-info { flex: 1; }
        .item-info b { font-size: 0.9rem; display: block; }
        .item-info small { font-size: 0.7rem; color: #aaa; }

        /* ì¹´ë“œ ë° ê°€ì°¨ */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .card { background: #111; border-radius: 15px; border: 2px solid #333; overflow: hidden; text-align: center; padding-bottom: 10px; position: relative; }
        .card img { width: 100%; height: 100px; object-fit: cover; }
        .badge { position: absolute; top: 5px; right: 5px; padding: 2px 6px; border-radius: 4px; font-size: 0.6rem; font-weight: bold; background: #000; }

        /* í•˜ë‹¨ ë„¤ë¹„ */
        .nav { position: absolute; bottom: 0; width: 100%; height: 80px; display: flex; background: #0a0a0f; border-top: 2px solid #333; z-index: 200; }
        .nav-btn { flex: 1; border: none; background: none; color: #555; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold; }
        .nav-btn.active { color: var(--dia); }
        .nav-btn span { font-size: 1.4rem; margin-bottom: 3px; }

        /* ë²„íŠ¼ */
        .btn { border: none; border-radius: 10px; cursor: pointer; font-weight: bold; color: white; transition: 0.2s; }
        .btn-buy { background: var(--gold); color: black; padding: 8px 12px; font-size: 0.8rem; }
        .btn-p { background: linear-gradient(135deg, #ff416c, #ff4b2b); width: 100%; padding: 15px; font-size: 1rem; }
        .btn-g { background: #333; width: 100%; padding: 15px; margin-bottom: 10px; }

        .hidden { display: none; }
        #toast { position: fixed; top: 15%; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.9); padding: 12px 25px; border-radius: 30px; border: 1px solid var(--ssr); z-index: 1000; opacity: 0; transition: 0.3s; pointer-events: none; }
        
        /* íŠ¹ìˆ˜ íš¨ê³¼ */
        .atk-buff-fx { border-color: #ff4757 !important; box-shadow: 0 0 20px #ff4757; }
        .auto-buff-fx { border-color: var(--dia) !important; box-shadow: 0 0 20px var(--dia); }
    </style>
</head>
<body>

<div id="toast">ì•Œë¦¼</div>

<div id="app">
    <div class="status-bar">
        <div class="stat-card" style="color:var(--dia)">ğŸ’ <span id="val-dia">0</span></div>
        <div class="stat-card" style="color:var(--gold)">ğŸ’° <span id="val-gold">0</span></div>
    </div>

    <div class="content">
        <div id="tab-battle">
            <h3 style="text-align:center;">âš”ï¸ INFINITE FIELD</h3>
            <div class="battle-view" id="battle-area">
                <div style="font-size: 0.8rem; font-weight: bold; color:var(--ssr);">STAGE <span id="cur-stage">1</span></div>
                <div class="monster-box"><div class="monster-img" id="monster-icon">ğŸ‘¹</div></div>
                <div class="hp-bar"><div id="hp-fill" class="hp-fill"></div></div>
                <div style="font-size: 0.7rem; color: #888; margin-bottom: 10px;">
                    ë°ë¯¸ì§€: <span id="val-dps">0</span> | 
                    ìë™í´ë¦­: <span id="auto-timer">OFF</span>
                </div>
                <button class="btn btn-p" onclick="manualHit()">ì§‘ì¤‘ ê³µê²© (CLICK)</button>
            </div>

            <div id="artifact-section">
                <h4 style="margin: 20px 0 10px 0;">ğŸº ë³´ìœ  ìœ ë¬¼</h4>
                <div id="arti-list" class="grid"></div>
            </div>
        </div>

        <div id="tab-draw" class="hidden">
            <h3 style="text-align:center;">ğŸ”® ì†Œí™˜ì˜ ë¬¸</h3>
            <div id="draw-area" class="grid" style="margin-bottom:15px;"></div>
            <button class="btn btn-g" onclick="summon(1)">1íšŒ ì†Œí™˜ (100ğŸ’)</button>
            <button class="btn btn-p" onclick="summon(10)">10íšŒ ì†Œí™˜ (1,000ğŸ’)</button>
        </div>

        <div id="tab-shop" class="hidden">
            <h3 style="text-align:center;">ğŸ¦ ì œêµ­ ì€í–‰ & ìƒì </h3>
            
            <div class="menu-box" style="background:rgba(0,242,255,0.05); padding:15px; border-radius:15px; border:1px solid var(--dia); margin-bottom:20px;">
                <b style="color:var(--dia);">ğŸ’ ë‹¤ì´ì•„ í™˜ì „ì†Œ</b><br>
                <small style="color:#aaa;">10,000ğŸ’° â†’ 100ğŸ’</small>
                <button class="btn btn-buy" style="float:right; margin-top:-15px;" onclick="exchangeDia()">í™˜ì „í•˜ê¸°</button>
            </div>

            <div id="shop-list">
                <div class="item-row">
                    <div class="item-icon">âš¡</div>
                    <div class="item-info"><b>ì´ˆê³ ì† ì˜¤í† </b><small>30ì´ˆê°„ ì´ˆë‹¹ 15íšŒ ìë™ í´ë¦­</small></div>
                    <button class="btn btn-buy" onclick="buyItem('auto', 3000)">3,000ğŸ’°</button>
                </div>
                <div class="item-row">
                    <div class="item-icon">ğŸ·</div>
                    <div class="item-info"><b>ê´‘í­í™” ë¬¼ì•½</b><small>60ì´ˆê°„ ê³µê²©ë ¥ 3ë°°</small></div>
                    <button class="btn btn-buy" onclick="buyItem('atk', 7000)">7,000ğŸ’°</button>
                </div>
                <div class="item-row">
                    <div class="item-icon">ğŸ”°</div>
                    <div class="item-info"><b>ì œë ¨ ë³´í˜¸ì„</b><small>ì‹¤íŒ¨ ì‹œ ë“±ê¸‰ í•˜ë½ ë°©ì§€</small></div>
                    <button class="btn btn-buy" onclick="buyItem('prot', 15000)">15,000ğŸ’°</button>
                </div>
            </div>
        </div>

        <div id="tab-manage" class="hidden">
            <h3 style="text-align:center;">ğŸ‘¤ êµ°ë‹¨ ë° ì œë ¨</h3>
            <div class="item-row" style="display:block; text-align:center;">
                <div style="font-size:1.2rem; margin-bottom:10px;">ë¬´ê¸° ì œë ¨: <span style="color:var(--ssr)">+<span id="val-wp">0</span></span></div>
                <button class="btn btn-p" style="background:var(--gold); color:black;" onclick="upgrade()">ì œë ¨ ì‹œì‘ (<span id="up-cost">0</span>ğŸ’°)</button>
                <div id="prot-ui" style="font-size:0.7rem; color:var(--dia); margin-top:5px;">ë³´í˜¸ì„ ë¯¸ë³´ìœ </div>
            </div>
            
            <h4 style="margin:20px 0 10px 0;">âš”ï¸ ë³´ìœ  ì˜ì›…</h4>
            <div id="inv-list"></div>
        </div>
    </div>

    <nav class="nav">
        <button class="nav-btn active" onclick="nav('battle')"><span>âš”ï¸</span>ì „íˆ¬</button>
        <button class="nav-btn" onclick="nav('draw')"><span>ğŸ”®</span>ì†Œí™˜</button>
        <button class="nav-btn" onclick="nav('shop')"><span>ğŸ›’</span>ìƒì </button>
        <button class="nav-btn" onclick="nav('manage')"><span>ğŸ‘¤</span>ê´€ë¦¬</button>
    </nav>
</div>

<script>
    /* --- ê²Œì„ ë°ì´í„° --- */
    let game = JSON.parse(localStorage.getItem('mythic_empire_ultimate')) || {
        dia: 1000, gold: 0, wp: 0, stage: 1, inv: [], col: [], mHp: 2000, maxHp: 2000, prot: 0,
        artis: { 1: 0, 2: 0, 3: 0 } // ìœ ë¬¼ ë ˆë²¨
    };

    let buffs = { auto: 0, atk: 0 };
    const ARTI_DB = [
        { id: 1, name: "ê³ ëŒ€ ë‚˜ì¹¨ë°˜", desc: "ë‹¤ì´ì•„ ë“œë í™•ë¥  ì¦ê°€", icon: "ğŸ§­" },
        { id: 2, name: "ìš©ì˜ ì—¬ì˜ì£¼", desc: "ì˜ì›… ê³µê²©ë ¥ ì¦ê°€", icon: "ğŸ”®" },
        { id: 3, name: "í™©ê¸ˆ ì‚¬ê³¼", desc: "ê³¨ë“œ íšë“ëŸ‰ ì¦ê°€", icon: "ğŸ" }
    ];

    const HERO_DB = [];
    for(let i=1; i<=40; i++) {
        let g = i > 35 ? "MYTHIC" : (i > 25 ? "SSR" : "SR");
        HERO_DB.push({ id: i, name: `ìš©ì‚¬ ${i}`, grade: g, atk: i*25 + (i > 25 ? 2500 : 300), price: i*150 });
    }

    function msg(m) {
        const t = document.getElementById('toast');
        t.innerText = m; t.style.opacity = 1;
        setTimeout(() => t.style.opacity = 0, 1500);
    }

    /* --- ì „íˆ¬ ë° íŒŒë° --- */
    function calcAtk() {
        let artiBonus = 1 + (game.artis[2] * 0.2); // ìœ ë¬¼ë‹¹ 20% ì¦í­
        let base = (game.inv.reduce((s, h) => s + h.atk, 0) + (game.wp * 400) + 15) * artiBonus;
        return buffs.atk > 0 ? base * 3 : base;
    }

    function manualHit() {
        hit(calcAtk());
        spawnText(`-${Math.floor(calcAtk())}`, '#fff');
    }

    function hit(d) {
        game.mHp -= d;
        if(game.mHp <= 0) {
            // ê³¨ë“œ ë³´ìƒ (ìœ ë¬¼ ë³´ë„ˆìŠ¤ í¬í•¨)
            let goldBonus = 1 + (game.artis[3] * 0.3);
            let goldReward = Math.floor((100 + (game.stage * 60)) * goldBonus);
            game.gold += goldReward;
            
            // ë‹¤ì´ì•„ ë“œë (ìœ ë¬¼ ë³´ë„ˆìŠ¤ í¬í•¨)
            let diaChance = 0.3 + (game.artis[1] * 0.1);
            if(Math.random() < diaChance) {
                let diaDrop = 5 + Math.floor(Math.random() * 11);
                game.dia += diaDrop;
                spawnText(`+${diaDrop}ğŸ’`, 'var(--dia)');
            }

            // 10ìŠ¤í…Œì´ì§€ë§ˆë‹¤ ìœ ë¬¼ ì¡°ê° íšë“ (í™•ë¥ ì  ë ˆë²¨ì—…)
            if(game.stage % 10 === 0) {
                let rArti = Math.floor(Math.random() * 3) + 1;
                game.artis[rArti]++;
                msg(`ğŸº ìœ ë¬¼ ë°œê²¬! [${ARTI_DB[rArti-1].name}] ë ˆë²¨ì—…!`);
            }

            game.stage++;
            game.maxHp = Math.floor(2000 * Math.pow(1.35, game.stage-1));
            game.mHp = game.maxHp;
            updateMonster();
        }
        updateUI();
    }

    function spawnText(txt, color) {
        const t = document.createElement('div');
        t.className = 'floating-text';
        t.innerText = txt;
        t.style.color = color;
        t.style.left = (40 + Math.random() * 20) + '%';
        t.style.top = '40%';
        document.getElementById('battle-area').appendChild(t);
        setTimeout(() => t.remove(), 800);
    }

    setInterval(() => {
        hit(calcAtk() / 10);
        if(buffs.auto > 0) {
            hit(calcAtk() / 1.5); // ìë™í´ë¦­ ì—°íƒ€
            buffs.auto -= 0.1;
        }
        if(buffs.atk > 0) buffs.atk -= 0.1;
    }, 100);

    /* --- ìƒì  & í™˜ì „ --- */
    function exchangeDia() {
        if(game.gold < 10000) return msg("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! (1ë§Œ ê³¨ë“œ í•„ìš”)");
        game.gold -= 10000;
        game.dia += 100;
        msg("í™˜ì „ ì„±ê³µ! 100ğŸ’ íšë“");
        updateUI(); save();
    }

    function buyItem(type, price) {
        if(game.gold < price) return msg("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
        game.gold -= price;
        if(type === 'auto') { buffs.auto = 30; msg("ì´ˆê³ ì† ì˜¤í†  í™œì„±í™”!"); }
        if(type === 'atk') { buffs.atk = 60; msg("ê´‘í­í™” ë¬¼ì•½ ì‚¬ìš©!"); }
        if(type === 'prot') { game.prot++; msg("ë³´í˜¸ì„ íšë“!"); }
        updateUI(); save();
    }

    /* --- ê°€ì°¨ & ê°•í™” --- */
    function summon(n) {
        if(game.dia < n*100) return msg("ë‹¤ì´ì•„ ë¶€ì¡±!");
        game.dia -= n*100;
        const area = document.getElementById('draw-area'); area.innerHTML = '';
        for(let i=0; i<n; i++) {
            setTimeout(() => {
                let pick = Math.random() < 0.15 ? {id:-1, name:"íŒŒí¸", grade:"FAIL"} : HERO_DB[Math.floor(Math.random()*HERO_DB.length)];
                if(pick.id !== -1) game.inv.push({...pick, uid:Math.random()});
                area.innerHTML += `<div class="card"><img src="https://loremflickr.com/200/200/fantasy?sig=${Math.random()}"><div class="badge" style="color:var(--${pick.grade.toLowerCase()})">${pick.grade}</div><b>${pick.name}</b></div>`;
                updateUI(); save();
            }, i*80);
        }
    }

    function upgrade() {
        let cost = 1000 + (game.wp * 1500);
        if(game.gold < cost) return msg("ê³¨ë“œ ë¶€ì¡±!");
        game.gold -= cost;
        if(Math.random()*100 < Math.max(50 - (game.wp*3), 5)) {
            game.wp++; msg("ì œë ¨ ì„±ê³µ! íŒŒì›Œ ì—…!");
        } else {
            if(game.prot > 0) { game.prot--; msg("ë³´í˜¸ì„ì´ íŒŒê´´ë¥¼ ë§‰ì•˜ìŠµë‹ˆë‹¤!"); }
            else { game.wp = Math.max(0, game.wp-1); msg("ì œë ¨ ì‹¤íŒ¨! ë“±ê¸‰ í•˜ë½!"); }
        }
        updateUI(); save();
    }

    /* --- UI --- */
    function nav(t) {
        document.querySelectorAll('.content > div').forEach(d => d.classList.add('hidden'));
        document.getElementById('tab-' + t).classList.remove('hidden');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        event.currentTarget.classList.add('active');
        if(t === 'manage') renderInv();
        if(t === 'battle') renderArtis();
    }

    function renderArtis() {
        const area = document.getElementById('arti-list'); area.innerHTML = '';
        ARTI_DB.forEach(a => {
            if(game.artis[a.id] > 0) {
                area.innerHTML += `<div class="card" style="padding:10px; border-color:var(--ssr)">
                    <div style="font-size:2rem;">${a.icon}</div>
                    <b style="font-size:0.8rem;">${a.name} Lv.${game.artis[a.id]}</b><br>
                    <small style="font-size:0.6rem; color:#aaa;">${a.desc}</small>
                </div>`;
            }
        });
    }

    function renderInv() {
        const l = document.getElementById('inv-list'); l.innerHTML = '';
        game.inv.forEach((h, idx) => {
            l.innerHTML += `<div class="item-row">
                <div class="item-info"><b style="color:var(--${h.grade.toLowerCase()})">${h.name}</b><small>ATK: ${h.atk}</small></div>
                <button class="btn btn-buy" onclick="sell(${idx})">íŒë§¤</button>
            </div>`;
        });
    }

    function sell(idx) {
        game.gold += game.inv[idx].price;
        game.inv.splice(idx, 1);
        renderInv(); updateUI(); save();
    }

    function updateMonster() {
        const icons = ["ğŸ‘¹", "ğŸ‰", "ğŸ™", "ğŸ§™", "ğŸ§›", "ğŸ§Ÿ", "ğŸ¦–"];
        document.getElementById('monster-icon').innerText = icons[game.stage % icons.length];
    }

    function updateUI() {
        document.getElementById('val-dia').innerText = game.dia.toLocaleString();
        document.getElementById('val-gold').innerText = game.gold.toLocaleString();
        document.getElementById('hp-fill').style.width = (game.mHp / game.maxHp * 100) + '%';
        document.getElementById('cur-stage').innerText = game.stage;
        document.getElementById('val-dps').innerText = Math.floor(calcAtk()).toLocaleString();
        document.getElementById('auto-timer').innerText = buffs.auto > 0 ? Math.ceil(buffs.auto) + 's' : 'OFF';
        document.getElementById('val-wp').innerText = game.wp;
        document.getElementById('up-cost').innerText = (1000 + (game.wp * 1500)).toLocaleString();
        document.getElementById('prot-ui').innerText = `ë³´í˜¸ì„ ë³´ìœ : ${game.prot}ê°œ`;
        
        const bArea = document.getElementById('battle-area');
        bArea.className = 'battle-view';
        if(buffs.atk > 0) bArea.classList.add('atk-buff-fx');
        if(buffs.auto > 0) bArea.classList.add('auto-buff-fx');
    }

    function save() { localStorage.setItem('mythic_empire_ultimate', JSON.stringify(game)); }
    updateUI(); updateMonster(); renderArtis();
</script>
</body>
</html>
