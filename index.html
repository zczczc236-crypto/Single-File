<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mythic Gacha: Ultimate</title>
    <style>
        :root {
            --ssr: #ffae00; --sr: #a335ee; --r: #1eff00;
            --gold: #ffd700; --dia: #00f2ff;
            --bg: #0a0a0c;
        }

        body {
            margin: 0; background-color: var(--bg); color: white;
            font-family: 'Pretendard', sans-serif; display: flex; justify-content: center;
        }

        #app {
            width: 100%; max-width: 480px; height: 100vh;
            display: flex; flex-direction: column; position: relative;
            background: radial-gradient(circle at top, #1a1a2e, #0a0a0c);
        }

        /* í—¤ë”: ìì› í‘œì‹œ */
        .status-bar {
            display: flex; justify-content: space-around; padding: 15px;
            background: rgba(0,0,0,0.6); border-bottom: 1px solid #333;
        }
        .res { font-weight: bold; font-size: 0.9rem; }
        .res.dia { color: var(--dia); }
        .res.gold { color: var(--gold); }

        /* ë©”ì¸ ì˜ì—­ */
        .content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 80px; }

        /* íƒ­ ë©”ë‰´ */
        .nav {
            position: absolute; bottom: 0; width: 100%; height: 60px;
            display: flex; background: #111; border-top: 1px solid #333;
        }
        .nav-btn {
            flex: 1; border: none; background: none; color: #888;
            cursor: pointer; font-weight: bold; transition: 0.3s;
        }
        .nav-btn.active { color: white; background: rgba(255,255,255,0.05); }

        /* ê°€ì°¨ ì—°ì¶œ */
        #gacha-screen { text-align: center; }
        .card-container {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;
            margin-top: 20px; min-height: 200px;
        }
        .card {
            background: #222; border-radius: 10px; overflow: hidden;
            border: 2px solid #444; position: relative; animation: flip 0.5s ease-out;
        }
        .card img { width: 100%; height: 120px; object-fit: cover; }
        .card-info { padding: 8px; font-size: 0.8rem; }
        .grade-badge { position: absolute; top: 5px; right: 5px; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; }

        @keyframes flip { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* ì¸ë²¤í† ë¦¬ & ìƒì  ë¦¬ìŠ¤íŠ¸ */
        .item-row {
            display: flex; align-items: center; background: rgba(255,255,255,0.05);
            margin-bottom: 8px; padding: 10px; border-radius: 8px;
        }
        .item-row img { width: 40px; height: 40px; border-radius: 4px; margin-right: 12px; }
        .item-name { flex: 1; font-size: 0.9rem; }
        .btn-sm { padding: 5px 10px; border-radius: 4px; border: none; cursor: pointer; font-size: 0.7rem; }
        .btn-sell { background: #e94560; color: white; }
        .btn-buy { background: #0f3460; color: white; }

        /* ì†Œí™˜ ë²„íŠ¼ */
        .draw-btns { margin-top: 30px; display: flex; gap: 10px; }
        .btn-main {
            flex: 1; padding: 15px; border-radius: 10px; border: none;
            font-weight: bold; cursor: pointer; background: linear-gradient(45deg, #444, #222); color: white;
        }
        .btn-premium { background: linear-gradient(45deg, #f09819, #edde5d); color: #000; }

        .hidden { display: none; }
    </style>
</head>
<body>

<div id="app">
    <div class="status-bar">
        <div class="res dia">ğŸ’ ë‹¤ì´ì•„: <span id="dia-count">1,000</span></div>
        <div class="res gold">ğŸ’° ê³¨ë“œ: <span id="gold-count">0</span></div>
    </div>

    <div class="content">
        <div id="tab-gacha">
            <h2 style="text-align:center">ì‹ í™”ì˜ ì œë‹¨</h2>
            <div id="gacha-display" class="card-container">
                <p style="grid-column: 1/-1; color: #666;">ìš´ëª…ì„ ì„ íƒí•˜ì„¸ìš”...</p>
            </div>
            <div class="draw-btns">
                <button class="btn-main" onclick="playGacha(1)">1íšŒ (100ğŸ’)</button>
                <button class="btn-main btn-premium" onclick="playGacha(10)">10íšŒ (1000ğŸ’)</button>
            </div>
        </div>

        <div id="tab-inventory" class="hidden">
            <h2>ë³´ê´€í•¨</h2>
            <div id="inventory-list"></div>
        </div>

        <div id="tab-shop" class="hidden">
            <h2>ì•”ì‹œì¥</h2>
            <div class="item-row">
                <div class="item-name">ğŸ’ ë‹¤ì´ì•„ 500ê°œ êµ¬ë§¤</div>
                <button class="btn-sm btn-buy" onclick="buyCurrency('dia', 500, 5000)">5,000ğŸ’°</button>
            </div>
            <div class="item-row">
                <div class="item-name">ğŸ’ ë‹¤ì´ì•„ 1200ê°œ êµ¬ë§¤</div>
                <button class="btn-sm btn-buy" onclick="buyCurrency('dia', 1200, 10000)">10,000ğŸ’°</button>
            </div>
        </div>
    </div>

    <nav class="nav">
        <button class="nav-btn active" onclick="switchTab('gacha')">ì†Œí™˜</button>
        <button class="nav-btn" onclick="switchTab('inventory')">ê°€ë°©</button>
        <button class="nav-btn" onclick="switchTab('shop')">ìƒì </button>
    </nav>
</div>

<script>
    /* --- ì•„ì´í…œ ë°ì´í„°ë² ì´ìŠ¤ (ëŒ€ëŸ‰ ì¶”ê°€) --- */
    const itemDB = [
        { id: 1, name: "ëŒ€ì²œì‚¬ ë£¨ì‹œí ", grade: "SSR", price: 5000, img: "https://loremflickr.com/200/200/angel,fantasy" },
        { id: 2, name: "ì§€ì˜¥ì˜ ë²¨ë¦¬ì•Œ", grade: "SSR", price: 5000, img: "https://loremflickr.com/200/200/demon,fantasy" },
        { id: 3, name: "ë“œë˜ê³¤ ìŠ¬ë ˆì´ì–´", grade: "SSR", price: 4500, img: "https://loremflickr.com/200/200/dragon,knight" },
        { id: 4, name: "ì„±ê¸°ì‚¬ ë¡¤ë‘", grade: "SR", price: 1200, img: "https://loremflickr.com/200/200/paladin" },
        { id: 5, name: "ë°¤ì˜ ì¶”ì ì", grade: "SR", price: 1000, img: "https://loremflickr.com/200/200/assassin" },
        { id: 6, name: "ì—˜í”„ ê¶ìˆ˜", grade: "SR", price: 1000, img: "https://loremflickr.com/200/200/elf,archer" },
        { id: 7, name: "í™”ì—¼ ë§ˆë²•ì‚¬", grade: "SR", price: 1000, img: "https://loremflickr.com/200/200/wizard" },
        { id: 8, name: "ê°•ì²  ë³‘ì‚¬", grade: "R", price: 300, img: "https://loremflickr.com/200/200/soldier" },
        { id: 9, name: "ìˆ²ì˜ ìŠ¬ë¼ì„", grade: "R", price: 200, img: "https://loremflickr.com/200/200/slime" },
        { id: 10, name: "ë…¹ìŠ¨ ì¹¼ë‚ ", grade: "R", price: 150, img: "https://loremflickr.com/200/200/sword" },
        { id: 11, name: "í•´ê³¨ ê¶ìˆ˜", grade: "R", price: 250, img: "https://loremflickr.com/200/200/skeleton" },
        { id: 12, name: "ê³ ë¸”ë¦° ë„ë‘‘", grade: "R", price: 200, img: "https://loremflickr.com/200/200/goblin" }
    ];

    // ê²Œì„ ìƒíƒœ
    let state = JSON.parse(localStorage.getItem('gacha_v3_state')) || {
        dia: 2000,
        gold: 0,
        inventory: []
    };

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    /* --- ì‚¬ìš´ë“œ í•¨ìˆ˜ --- */
    function beep(freq, dur) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.frequency.value = freq;
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
        osc.start(); osc.stop(audioCtx.currentTime + dur);
    }

    /* --- í™”ë©´ ì „í™˜ --- */
    function switchTab(tabId) {
        document.querySelectorAll('.content > div').forEach(el => el.classList.add('hidden'));
        document.getElementById('tab-' + tabId).classList.remove('hidden');
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        event.currentTarget.classList.add('active');
        if(tabId === 'inventory') renderInventory();
    }

    /* --- ë½‘ê¸° ë¡œì§ --- */
    function playGacha(count) {
        const cost = count * 100;
        if(state.dia < cost) return alert("ë‹¤ì´ì•„ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");

        state.dia -= cost;
        const display = document.getElementById('gacha-display');
        display.innerHTML = '';

        for(let i=0; i<count; i++) {
            setTimeout(() => {
                const result = pullItem();
                state.inventory.push({...result, uuid: Date.now() + Math.random()});
                addCardToDisplay(result);
                beep(result.grade === 'SSR' ? 880 : 440, 0.2);
                save();
                updateTopBar();
            }, i * 100);
        }
    }

    function pullItem() {
        const rand = Math.random() * 100;
        if(rand < 3) return itemDB.filter(i => i.grade === 'SSR')[Math.floor(Math.random()*3)];
        if(rand < 20) return itemDB.filter(i => i.grade === 'SR')[Math.floor(Math.random()*4)];
        return itemDB.filter(i => i.grade === 'R')[Math.floor(Math.random()*5)];
    }

    function addCardToDisplay(item) {
        const div = document.createElement('div');
        div.className = `card`;
        div.style.borderColor = `var(--${item.grade.toLowerCase()})`;
        div.innerHTML = `
            <span class="grade-badge" style="background:var(--${item.grade.toLowerCase()})">${item.grade}</span>
            <img src="${item.img}" alt="${item.name}">
            <div class="card-info"><b>${item.name}</b></div>
        `;
        document.getElementById('gacha-display').appendChild(div);
    }

    /* --- ì¸ë²¤í† ë¦¬ & íŒë§¤ --- */
    function renderInventory() {
        const list = document.getElementById('inventory-list');
        list.innerHTML = state.inventory.length === 0 ? '<p>ê°€ë°©ì´ ë¹„ì—ˆìŠµë‹ˆë‹¤.</p>' : '';
        state.inventory.forEach((item, index) => {
            const row = document.createElement('div');
            row.className = 'item-row';
            row.innerHTML = `
                <img src="${item.img}">
                <div class="item-name">
                    <b style="color:var(--${item.grade.toLowerCase()})">[${item.grade}]</b> ${item.name}<br>
                    <small>ê°€ì¹˜: ${item.price}ğŸ’°</small>
                </div>
                <button class="btn-sm btn-sell" onclick="sellItem(${index})">íŒë§¤</button>
            `;
            list.appendChild(row);
        });
    }

    function sellItem(index) {
        const item = state.inventory[index];
        state.gold += item.price;
        state.inventory.splice(index, 1);
        save();
        updateTopBar();
        renderInventory();
        beep(600, 0.1);
    }

    /* --- ìƒì  --- */
    function buyCurrency(type, amount, price) {
        if(state.gold < price) return alert("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
        state.gold -= price;
        state[type] += amount;
        save();
        updateTopBar();
        alert(`${amount} ë‹¤ì´ì•„ë¥¼ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤!`);
    }

    /* --- ì‹œìŠ¤í…œ --- */
    function updateTopBar() {
        document.getElementById('dia-count').innerText = state.dia.toLocaleString();
        document.getElementById('gold-count').innerText = state.gold.toLocaleString();
    }
    function save() { localStorage.setItem('gacha_v3_state', JSON.stringify(state)); }
    updateTopBar();
</script>

</body>
  </html>
