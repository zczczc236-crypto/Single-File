<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-select=none">
    <title>Mythic Overlord: Visual Saga</title>
    <style>
        :root {
            --mythic: #ff4757; --ssr: #ffa502; --sr: #7ed6df; --bg: #0a0a12;
            --gold: #ffd700; --dia: #00d2ff; --panel: rgba(255, 255, 255, 0.05);
            --text: #e0e0e0;
        }
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Pretendard', sans-serif; display: flex; justify-content: center; height: 100vh; overflow: hidden; }
        
        #app { width: 100%; max-width: 480px; height: 100%; display: flex; flex-direction: column; background: radial-gradient(circle at top, #1e1e30 0%, #0a0a12 100%); position: relative; border-left: 1px solid #333; border-right: 1px solid #333; }

        .header { padding: 15px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; background: rgba(0,0,0,0.85); border-bottom: 2px solid #333; z-index: 10; }
        .stat-box { background: var(--panel); padding: 8px; border-radius: 10px; text-align: center; border: 1px solid #444; }
        .stat-box div { font-size: 0.7rem; color: #888; margin-bottom: 2px; }
        .stat-box span { font-size: 0.85rem; font-weight: bold; }

        .main-content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; scrollbar-width: none; }
        .main-content::-webkit-scrollbar { display: none; }

        .battle-stage { background: var(--panel); border-radius: 25px; border: 2px solid #444; padding: 25px 15px; text-align: center; margin-bottom: 20px; }
        .monster-box { width: 100%; height: 160px; display: flex; align-items: center; justify-content: center; margin: 10px 0; }
        .monster-img { max-width: 140px; height: 140px; object-fit: contain; filter: drop-shadow(0 0 10px rgba(255,255,255,0.2)); }

        .hp-container { height: 20px; background: #222; border-radius: 10px; border: 1px solid #555; overflow: hidden; position: relative; margin: 15px 0; }
        .hp-bar { height: 100%; background: linear-gradient(90deg, #ff4757, #ff6b81); width: 100%; transition: width 0.1s linear; }
        .hp-text { position: absolute; width: 100%; text-align: center; font-size: 0.7rem; line-height: 20px; font-weight: bold; text-shadow: 1px 1px 2px black; color: white; }

        .card { background: var(--panel); border: 1px solid #333; border-radius: 15px; padding: 12px; display: flex; align-items: center; margin-bottom: 12px; }
        .hero-icon { width: 60px; height: 60px; border-radius: 12px; background: #000; overflow: hidden; margin-right: 15px; border: 2px solid #444; flex-shrink: 0; }
        .hero-icon img { width: 100%; height: 100%; object-fit: cover; }
        .hero-info { flex: 1; }
        .hero-info b { font-size: 0.95rem; display: block; margin-bottom: 4px; }
        .hero-info small { color: #888; font-size: 0.75rem; }

        .nav { position: absolute; bottom: 0; width: 100%; height: 75px; background: #05050a; display: flex; border-top: 2px solid #333; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #555; font-size: 0.7rem; cursor: pointer; }
        .nav-item.active { color: var(--dia); }
        .nav-item i { font-style: normal; font-size: 1.4rem; margin-bottom: 3px; }

        .btn { border: none; border-radius: 12px; font-weight: bold; cursor: pointer; color: white; transition: 0.2s; }
        .btn:active { transform: scale(0.95); }
        .btn-hit { width: 100%; padding: 15px; font-size: 1.1rem; background: linear-gradient(135deg, #ff416c, #ff4b2b); }
        .btn-buy { background: var(--gold); color: black; padding: 6px 12px; font-size: 0.75rem; }
        .btn-sm { padding: 5px 10px; font-size: 0.7rem; background: #444; }

        .book-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .book-item { aspect-ratio: 1; background: #111; border-radius: 12px; border: 1px solid #222; overflow: hidden; opacity: 0.2; filter: grayscale(1); }
        .book-item img { width: 100%; height: 100%; object-fit: cover; }
        .book-item.active { opacity: 1; filter: grayscale(0); border-color: var(--ssr); }

        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 30px; text-align: center; }
        #toast { position: fixed; top: 10%; left: 50%; transform: translateX(-50%); background: var(--dia); color: black; padding: 10px 20px; border-radius: 20px; font-weight: bold; opacity: 0; transition: 0.3s; z-index: 2000; pointer-events: none; }
        .hidden { display: none !important; }
        .shake { animation: shake 0.1s infinite; }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -1px); } 100% { transform: translate(0,0); } }
        
        .color-sr { color: var(--sr); }
        .color-ssr { color: var(--ssr); }
        .color-mythic { color: var(--mythic); text-shadow: 0 0 5px var(--mythic); }
    </style>
</head>
<body>

<div id="toast">ë©”ì‹œì§€</div>

<div id="auth-screen" class="overlay">
    <h1 style="color:var(--dia); margin:0; letter-spacing: 2px;">MYTHIC OVERLORD</h1>
    <p style="color:#666; font-size: 0.8rem; margin-bottom: 30px;">VISUAL SAGA EDITION</p>
    <input type="text" id="join-id" style="width:100%; padding:15px; background:#111; border:1px solid #444; color:white; border-radius:12px; margin-bottom:10px;" placeholder="ì˜ì£¼ ì•„ì´ë””">
    <input type="password" id="join-pw" style="width:100%; padding:15px; background:#111; border:1px solid #444; color:white; border-radius:12px; margin-bottom:20px;" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button class="btn btn-hit" onclick="Game.auth()">ì œêµ­ ì ‘ì†</button>
</div>

<div id="app" class="hidden">
    <header class="header">
        <div class="stat-box"><div>ğŸ’° ê³¨ë“œ</div><span id="txt-gold" style="color:var(--gold)">0</span></div>
        <div class="stat-box"><div>ğŸ’ ë‹¤ì´ì•„</div><span id="txt-dia" style="color:var(--dia)">0</span></div>
        <div class="stat-box"><div>âš”ï¸ íˆ¬ë ¥</div><span id="txt-atk" style="color:#00ff88">0</span></div>
    </header>

    <div class="main-content">
        <div id="tab-battle">
            <div class="battle-stage" id="stage-box">
                <div style="color:var(--ssr); font-weight:bold; font-size:0.8rem; margin-bottom:5px;">STAGE <span id="txt-stage">1</span></div>
                <div class="monster-box" id="monster-icon"></div>
                <div class="hp-container">
                    <div id="hp-bar" class="hp-bar"></div>
                    <div id="hp-text" class="hp-text">0 / 0</div>
                </div>
                <button class="btn btn-hit" onmousedown="Game.attack()">ê³µê²© ê°œì‹œ</button>
            </div>
            <div id="list-artis" style="display:grid; grid-template-columns:repeat(3, 1fr); gap:10px;"></div>
        </div>

        <div id="tab-draw" class="hidden">
            <h3 style="text-align:center;">ğŸ”® ì˜ì›… ì†Œí™˜</h3>
            <div id="draw-result" style="display:grid; grid-template-columns:repeat(5, 1fr); gap:8px; background:rgba(255,255,255,0.03); padding:15px; border-radius:20px; min-height:100px; margin-bottom:20px;"></div>
            <button class="btn btn-hit" onclick="Game.summon(10)">10íšŒ ì†Œí™˜ (1,000ğŸ’)</button>
        </div>

        <div id="tab-hero" class="hidden">
            <div class="card" style="border:1px dashed var(--dia);">
                <div class="hero-info">
                    <b>ğŸ”¨ ì „ì„¤ ì œë ¨ì†Œ (+<span id="txt-wp">0</span>)</b>
                    <small>ì„±ê³µë¥  35% | ë³´í˜¸ì„ ë³´ìœ : <span id="txt-prot">0</span></small>
                </div>
                <button class="btn btn-buy" onclick="Game.refine()">ì œë ¨ (2,000ğŸ’°)</button>
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h4 style="margin:0;">âš”ï¸ ë‚˜ì˜ ì˜ì›…ë“¤ (<span id="txt-hero-cnt">0</span>)</h4>
                <button class="btn btn-sm" onclick="Game.autoEvolve()">ì¼ê´„ í•©ì„±</button>
            </div>
            <div id="list-heroes"></div>
        </div>

        <div id="tab-book" class="hidden">
            <h3 style="text-align:center;">ğŸ“– ì œêµ­ ë„ê°</h3>
            <div id="grid-book" class="book-grid"></div>
        </div>

        <div id="tab-shop" class="hidden">
            <h3 style="text-align:center;">ğŸ›’ ì œêµ­ ìƒì </h3>
            <div class="card">
                <div class="hero-info"><b>ğŸ’ ë‹¤ì´ì•„ í™˜ì „</b><small>8,000ğŸ’° â” 100ğŸ’</small></div>
                <button class="btn btn-buy" onclick="Game.buyShop('dia')">í™˜ì „</button>
            </div>
            <div class="card">
                <div class="hero-info"><b>ğŸ›¡ï¸ ì œë ¨ ë³´í˜¸ì„</b><small>ê°•í™” ì‹¤íŒ¨ ë°©ì§€ (15,000ğŸ’°)</small></div>
                <button class="btn btn-buy" onclick="Game.buyShop('prot')">êµ¬ë§¤</button>
            </div>
        </div>
    </div>

    <nav class="nav">
        <div class="nav-item active" onclick="Game.changeTab('battle', this)"><i>âš”ï¸</i>ì „íˆ¬</div>
        <div class="nav-item" onclick="Game.changeTab('draw', this)"><i>ğŸ”®</i>ì†Œí™˜</div>
        <div class="nav-item" onclick="Game.changeTab('hero', this)"><i>ğŸ‘¤</i>êµ°ë‹¨</div>
        <div class="nav-item" onclick="Game.changeTab('book', this)"><i>ğŸ“–</i>ë„ê°</div>
        <div class="nav-item" onclick="Game.changeTab('shop', this)"><i>ğŸ›’</i>ìƒì </div>
    </nav>
</div>

<script>
/**
 * MYTHIC OVERLORD - FINAL STABLE ENGINE
 */
const Game = (() => {
    let user = "";
    let state = {
        gold: 0, dia: 3000, stage: 1, wp: 0, prot: 0,
        inv: [], book: [], artis: { 1:0, 2:0, 3:0 },
        mHp: 2000, maxHp: 2000
    };

    const HERO_DB = [];
    const AI_PROMPTS = {
        SR: "fantasy+knight+warrior+portrait",
        SSR: "magical+wizard+elf+glowing+portrait",
        MYTHIC: "godlike+armored+king+celestial+portrait"
    };

    // Initialize Hero Database with AI Image Mappings
    for(let i=1; i<=30; i++) {
        let g = i > 25 ? "MYTHIC" : (i > 15 ? "SSR" : "SR");
        HERO_DB.push({
            id: i,
            name: `${g} Hero #${i}`,
            grade: g,
            img: `https://image.pollinations.ai/prompt/${AI_PROMPTS[g]}+v${i}?width=150&height=150&nologo=true`,
            atk: i * 150 + (i > 15 ? 3000 : 300)
        });
    }

    const MONSTERS = ["slime", "skeleton", "orc", "spider", "demon", "dragon", "beholder", "golem"];

    const save = () => {
        if(!user) return;
        localStorage.setItem(`mo_saga_v3_${user}`, JSON.stringify(state));
    };

    const showToast = (m) => {
        const t = document.getElementById('toast');
        t.innerText = m; t.style.opacity = 1;
        setTimeout(() => t.style.opacity = 0, 1500);
    };

    const getAtk = () => {
        let base = state.inv.reduce((s, h) => s + (h.atk * h.star), 0);
        let bookBonus = 1 + (state.book.length * 0.05);
        let artiBonus = 1 + (state.artis[1] * 0.5);
        return (base + (state.wp * 1200) + 100) * bookBonus * artiBonus;
    };

    const updateMonster = () => {
        const mIdx = (state.stage - 1) % MONSTERS.length;
        const url = `https://image.pollinations.ai/prompt/fantasy+${MONSTERS[mIdx]}+monster+dark+background?width=250&height=250&nologo=true`;
        document.getElementById('monster-icon').innerHTML = `<img src="${url}" class="monster-img">`;
    };

    const render = {
        battle: () => {
            const area = document.getElementById('list-artis');
            area.innerHTML = '';
            [1,2,3].forEach(i => {
                area.innerHTML += `<div class="stat-box" style="font-size:0.7rem">ğŸº ìœ ë¬¼ Lv.${state.artis[i]}</div>`;
            });
        },
        hero: () => {
            const list = document.getElementById('list-heroes');
            list.innerHTML = '';
            state.inv.sort((a,b) => (b.atk*b.star) - (a.atk*a.star)).forEach(h => {
                list.innerHTML += `
                    <div class="card" style="border-color:${h.grade==='MYTHIC'?'#ff4757':'#444'}">
                        <div class="hero-icon"><img src="${h.img}" loading="lazy"></div>
                        <div class="hero-info">
                            <b class="color-${h.grade.toLowerCase()}">${h.name} [â˜…${h.star}]</b>
                            <small>ATK: ${Math.floor(h.atk * h.star).toLocaleString()}</small>
                        </div>
                        <button class="btn btn-sm" onclick="Game.sellHero(${h.uid})">íŒë§¤</button>
                    </div>`;
            });
            document.getElementById('txt-hero-cnt').innerText = state.inv.length;
            document.getElementById('txt-wp').innerText = state.wp;
            document.getElementById('txt-prot').innerText = state.prot;
        },
        book: () => {
            const grid = document.getElementById('grid-book');
            grid.innerHTML = '';
            HERO_DB.forEach(h => {
                const active = state.book.includes(h.id);
                grid.innerHTML += `<div class="book-item ${active?'active':''}"><img src="${h.img}" loading="lazy"></div>`;
            });
        }
    };

    return {
        auth: () => {
            const id = document.getElementById('join-id').value.trim();
            const pw = document.getElementById('join-pw').value.trim();
            if(!id || !pw) return alert("ê³„ì • ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
            
            user = id;
            const saved = localStorage.getItem(`mo_saga_v3_${id}`);
            if(saved) state = JSON.parse(saved);
            
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            Game.updateUI();
            updateMonster();
            
            setInterval(() => {
                Game.doDamage(getAtk() * 0.1, false);
            }, 1000);
        },

        attack: () => {
            Game.doDamage(getAtk(), true);
            const box = document.getElementById('stage-box');
            box.style.transform = "scale(0.98)";
            setTimeout(() => box.style.transform = "scale(1)", 50);
        },

        doDamage: (dmg, isManual) => {
            state.mHp -= dmg;
            if(state.mHp <= 0) {
                state.gold += (1000 + (state.stage * 250)) * (1 + (state.artis[2]*0.7));
                if(Math.random() < 0.15) {
                    state.artis[Math.floor(Math.random()*3)+1]++;
                    showToast("ğŸº ìœ ë¬¼ì˜ ê³µëª…ì„ ëŠë‚ë‹ˆë‹¤!");
                }
                state.stage++;
                state.maxHp = Math.floor(2000 * Math.pow(1.25, state.stage-1));
                state.mHp = state.maxHp;
                updateMonster();
                save();
            }
            Game.updateUI();
        },

        summon: (n) => {
            if(state.dia < 1000) return showToast("ë‹¤ì´ì•„ ë¶€ì¡±!");
            state.dia -= 1000;
            const resArea = document.getElementById('draw-result');
            resArea.innerHTML = '';
            for(let i=0; i<n; i++) {
                const pick = HERO_DB[Math.floor(Math.random() * HERO_DB.length)];
                const newHero = {...pick, uid: Date.now() + Math.random(), star: 1};
                state.inv.push(newHero);
                if(!state.book.includes(pick.id)) state.book.push(pick.id);
                resArea.innerHTML += `<div class="book-item active"><img src="${pick.img}"></div>`;
            }
            save();
            Game.updateUI();
        },

        autoEvolve: () => {
            let evolved = false;
            let map = {};
            state.inv.forEach(h => {
                if(!map[h.id]) map[h.id] = [];
                map[h.id].push(h);
            });

            for(let id in map) {
                while(map[id].length >= 2) {
                    let h1 = map[id].pop();
                    let h2 = map[id].pop();
                    h1.star += 1;
                    h1.atk *= 1.5;
                    state.inv = state.inv.filter(x => x.uid !== h2.uid);
                    evolved = true;
                }
            }
            if(evolved) {
                showToast("êµ°ë‹¨ í•©ì„± ì™„ë£Œ!");
                render.hero();
                save();
                Game.updateUI();
            } else {
                showToast("í•©ì„± ê°€ëŠ¥í•œ ì¤‘ë³µ ì˜ì›…ì´ ì—†ìŠµë‹ˆë‹¤.");
            }
        },

        sellHero: (uid) => {
            const h = state.inv.find(x => x.uid === uid);
            if(h) {
                state.gold += h.grade === "MYTHIC" ? 5000 : 500;
                state.inv = state.inv.filter(x => x.uid !== uid);
                render.hero();
                Game.updateUI();
                save();
            }
        },

        refine: () => {
            if(state.gold < 2000) return showToast("ê³¨ë“œ ë¶€ì¡±!");
            state.gold -= 2000;
            if(Math.random() < 0.35) {
                state.wp++; showToast("ì œë ¨ ì„±ê³µ!");
            } else {
                if(state.prot > 0) { state.prot--; showToast("ë³´í˜¸ì„ì´ íŒŒê´´ë¥¼ ë§‰ì•˜ìŠµë‹ˆë‹¤!"); }
                else { state.wp = Math.max(0, state.wp-1); showToast("ì œë ¨ ì‹¤íŒ¨ë¡œ ë“±ê¸‰ í•˜ë½.."); }
            }
            render.hero();
            Game.updateUI();
            save();
        },

        buyShop: (type) => {
            if(type === 'dia' && state.gold >= 8000) { state.gold -= 8000; state.dia += 100; }
            else if(type === 'prot' && state.gold >= 15000) { state.gold -= 15000; state.prot++; }
            else return showToast("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
            Game.updateUI();
            save();
        },

        changeTab: (tab, el) => {
            document.querySelectorAll('.main-content > div').forEach(d => d.classList.add('hidden'));
            document.getElementById(`tab-${tab}`).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            if(render[tab]) render[tab]();
        },

        updateUI: () => {
            document.getElementById('txt-gold').innerText = Math.floor(state.gold).toLocaleString();
            document.getElementById('txt-dia').innerText = Math.floor(state.dia).toLocaleString();
            document.getElementById('txt-atk').innerText = Math.floor(getAtk()).toLocaleString();
            document.getElementById('txt-stage').innerText = state.stage;
            const hpPer = Math.max(0, (state.mHp / state.maxHp) * 100);
            document.getElementById('hp-bar').style.width = hpPer + "%";
            document.getElementById('hp-text').innerText = `${Math.floor(Math.max(0, state.mHp)).toLocaleString()} / ${state.maxHp.toLocaleString()}`;
        }
    };
})();
</script>
</body>
</html>
