<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-select=none">
    <title>Mythic Overlord: Final</title>
    <style>
        :root {
            --mythic: #ff4757; --ssr: #ffa502; --sr: #7ed6df; --bg: #0a0a12;
            --gold: #ffd700; --dia: #00d2ff; --panel: rgba(255, 255, 255, 0.05);
        }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: #eee; height: 100vh; overflow: hidden; display: flex; justify-content: center; }
        
        #app { width: 100%; max-width: 480px; height: 100%; display: flex; flex-direction: column; position: relative; border-left: 1px solid #333; border-right: 1px solid #333; background: #000; }

        /* Status Bar */
        .header { padding: 10px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; background: #111; border-bottom: 2px solid #444; }
        .stat-box { background: var(--panel); padding: 5px; border-radius: 8px; text-align: center; border: 1px solid #222; }
        .stat-box small { font-size: 9px; color: #888; display: block; }
        .stat-box span { font-size: 13px; font-weight: bold; color: #fff; }

        /* Main Content */
        .main-content { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 100px; }
        .main-content::-webkit-scrollbar { display: none; }

        /* Battle Stage */
        .battle-area { background: linear-gradient(to bottom, #1a1a2e, #0a0a12); border-radius: 20px; border: 2px solid #444; padding: 20px; text-align: center; margin-bottom: 20px; position: relative; }
        .monster-display { font-size: 80px; height: 160px; display: flex; align-items: center; justify-content: center; filter: drop-shadow(0 0 15px rgba(255,255,255,0.2)); transition: 0.1s; user-select: none; }
        
        .hp-container { height: 25px; background: #222; border-radius: 12.5px; border: 1px solid #555; overflow: hidden; position: relative; margin: 15px 0; }
        .hp-bar { height: 100%; background: linear-gradient(90deg, #ff4757, #ff6b81); width: 100%; transition: width 0.1s; }
        .hp-text { position: absolute; width: 100%; text-align: center; font-size: 12px; line-height: 23px; font-weight: bold; text-shadow: 1px 1px 2px #000; }

        /* Cards */
        .card { background: var(--panel); border: 1px solid #333; border-radius: 12px; padding: 10px; display: flex; align-items: center; margin-bottom: 10px; border-left: 5px solid #555; }
        .card.MYTHIC { border-left-color: var(--mythic); background: rgba(255, 71, 87, 0.1); }
        .card.SSR { border-left-color: var(--ssr); }
        .card-img { width: 50px; height: 50px; background: #000; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px; margin-right: 12px; border: 1px solid #444; }
        .card-info { flex: 1; }
        .card-info b { font-size: 14px; display: block; }
        .card-info small { font-size: 11px; color: #aaa; }

        /* Nav Bar */
        .nav { position: absolute; bottom: 0; width: 100%; height: 70px; background: #111; display: flex; border-top: 1px solid #444; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #666; cursor: pointer; }
        .nav-item.active { color: var(--dia); background: #1a1a2e; }
        .nav-item i { font-size: 20px; margin-bottom: 3px; font-style: normal; }

        /* Buttons */
        .btn { border: none; border-radius: 10px; font-weight: bold; cursor: pointer; color: #fff; transition: 0.1s; }
        .btn:active { transform: scale(0.95); }
        .btn-hit { width: 100%; padding: 15px; font-size: 20px; background: linear-gradient(to right, #ff416c, #ff4b2b); box-shadow: 0 4px 15px rgba(255,0,0,0.3); }
        .btn-buy { background: var(--gold); color: #000; padding: 6px 12px; font-size: 11px; }

        /* Effects */
        #toast { position: fixed; top: 10%; left: 50%; transform: translateX(-50%); background: var(--dia); color: #000; padding: 10px 20px; border-radius: 20px; font-weight: bold; z-index: 1000; opacity: 0; transition: 0.3s; pointer-events: none; }
        .damage-pop { position: absolute; color: white; font-weight: bold; font-size: 20px; animation: floatUp 0.5s ease-out forwards; pointer-events: none; }
        @keyframes floatUp { 0% { opacity:1; transform:translateY(0); } 100% { opacity:0; transform:translateY(-100px); } }
        
        .hidden { display: none !important; }
        .overlay { position: fixed; inset: 0; background: #000; z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px; }
    </style>
</head>
<body>

<div id="toast"></div>

<div id="login-screen" class="overlay">
    <div style="font-size: 80px; margin-bottom: 20px;">üéñÔ∏è</div>
    <h1 style="margin: 0; color: var(--dia); letter-spacing: 5px;">OVERLORD</h1>
    <p style="color: #666; font-size: 12px; margin-bottom: 40px;">THE FINAL SAGA REBORN</p>
    <input type="text" id="join-id" style="width: 100%; padding: 15px; background: #111; border: 1px solid #444; color: #fff; border-radius: 10px; text-align: center;" placeholder="NICKNAME">
    <button class="btn btn-hit" style="margin-top: 20px;" onclick="Engine.start()">START EMPIRE</button>
</div>

<div id="app" class="hidden">
    <header class="header">
        <div class="stat-box"><small>GOLD</small><span id="txt-gold" style="color:var(--gold)">0</span></div>
        <div class="stat-box"><small>DIAMOND</small><span id="txt-dia" style="color:var(--dia)">0</span></div>
        <div class="stat-box"><small>POWER</small><span id="txt-atk" style="color:#00ff88">0</span></div>
    </header>

    <div class="main-content">
        <div id="tab-battle">
            <div class="battle-area" id="battle-screen">
                <div style="font-size: 12px; color: var(--ssr); margin-bottom: 10px;">STAGE <span id="txt-stage">1</span></div>
                <div class="monster-display" id="monster-icon">üëæ</div>
                <div class="hp-container">
                    <div id="hp-bar" class="hp-bar"></div>
                    <div id="hp-text" class="hp-text">0 / 0</div>
                </div>
                <button class="btn btn-hit" onmousedown="Engine.clickHit()">STRIKE</button>
            </div>
            <div id="artis-info" style="display:grid; grid-template-columns:repeat(3, 1fr); gap:10px;"></div>
        </div>

        <div id="tab-draw" class="hidden">
            <h3 style="text-align:center;">SUMMON HERO</h3>
            <div id="draw-result" style="display:grid; grid-template-columns:repeat(5, 1fr); gap:8px; background:rgba(255,255,255,0.05); padding:15px; border-radius:15px; min-height:150px; margin-bottom:20px;"></div>
            <button class="btn btn-hit" onclick="Engine.summon()">10 SUMMON (1,000üíé)</button>
        </div>

        <div id="tab-hero" class="hidden">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3 style="margin:0;">MY HEROES (<span id="txt-hcount">0</span>)</h3>
                <button class="btn btn-buy" onclick="Engine.autoMerge()">AUTO MERGE</button>
            </div>
            <div id="hero-list"></div>
        </div>

        <div id="tab-rank" class="hidden">
            <h3 style="text-align:center;">LEADERBOARD</h3>
            <div id="rank-list" style="margin-bottom:20px;"></div>
            <div class="card" style="border-left-color:var(--mythic);">
                <input type="text" id="target-id" style="flex:1; background:none; border:none; color:#fff; padding:10px;" placeholder="Target ID">
                <button class="btn btn-buy" style="background:var(--mythic); color:#fff;" onclick="Engine.plunder()">PLUNDER</button>
            </div>
        </div>

        <div id="tab-shop" class="hidden">
            <h3 style="text-align:center;">EMPIRE SHOP</h3>
            <div class="card">
                <div class="card-info"><b>Auto Strike (30s)</b><small>Current: <span id="txt-auto">0</span>s</small></div>
                <button class="btn btn-buy" onclick="Engine.buy('auto')">3,000üí∞</button>
            </div>
            <div class="card">
                <div class="card-info"><b>Diamond Box</b><small>10,000 Gold ‚Üí 100 Dia</small></div>
                <button class="btn btn-buy" onclick="Engine.buy('dia')">10,000üí∞</button>
            </div>
        </div>
    </div>

    <nav class="nav">
        <div class="nav-item active" onclick="Engine.tab('battle', this)"><i>‚öîÔ∏è</i>Battle</div>
        <div class="nav-item" onclick="Engine.tab('draw', this)"><i>üîÆ</i>Draw</div>
        <div class="nav-item" onclick="Engine.tab('hero', this)"><i>üõ°Ô∏è</i>Legion</div>
        <div class="nav-item" onclick="Engine.tab('rank', this)"><i>üèÜ</i>Rank</div>
        <div class="nav-item" onclick="Engine.tab('shop', this)"><i>üõí</i>Shop</div>
    </nav>
</div>

<script>
/**
 * MYTHIC OVERLORD: THE FINAL ENGINE
 */
const Engine = (() => {
    let user = "";
    let data = { gold: 5000, dia: 2000, stage: 1, inv: [], book: [], artis: {1:0, 2:0, 3:0}, mHp: 2000, maxHp: 2000 };
    let autoTime = 0;

    const HERO_DB = [];
    const EMOJIS = ["‚öîÔ∏è", "üõ°Ô∏è", "üèπ", "ü™Ñ", "üßô", "üßõ", "üßû", "üßö", "üßú", "ü¶Ñ", "ü¶Å", "üêâ", "üëë", "üíé"];
    for(let i=1; i<=30; i++) {
        let g = i > 25 ? "MYTHIC" : (i > 15 ? "SSR" : "SR");
        HERO_DB.push({
            id: i, name: `${g} Unit #${i}`, grade: g,
            emoji: EMOJIS[i % EMOJIS.length],
            atk: i * 300 + (i > 15 ? 10000 : 800)
        });
    }

    const MONSTERS = ["üëæ", "üëπ", "üíÄ", "üëª", "üêâ", "üßü", "üßõ", "üï∑Ô∏è", "ü¶Ç"];

    const showToast = (m) => {
        const t = document.getElementById('toast');
        t.innerText = m; t.style.opacity = 1;
        setTimeout(() => t.style.opacity = 0, 1500);
    };

    const getAtk = () => {
        let base = data.inv.reduce((s, h) => s + (h.atk * h.star), 0);
        let bonus = 1 + (data.book.length * 0.05) + (data.artis[1] * 0.5);
        return (base + 100) * bonus;
    };

    const save = () => {
        if(!user) return;
        const all = JSON.parse(localStorage.getItem('mo_final_db') || "{}");
        all[user] = data;
        localStorage.setItem('mo_final_db', JSON.stringify(all));
    };

    const updateUI = () => {
        document.getElementById('txt-gold').innerText = Math.floor(data.gold).toLocaleString();
        document.getElementById('txt-dia').innerText = Math.floor(data.dia).toLocaleString();
        document.getElementById('txt-atk').innerText = Math.floor(getAtk()).toLocaleString();
        document.getElementById('txt-stage').innerText = data.stage;
        document.getElementById('txt-auto').innerText = autoTime;
        
        const hpPer = Math.max(0, (data.mHp / data.maxHp) * 100);
        document.getElementById('hp-bar').style.width = hpPer + "%";
        document.getElementById('hp-text').innerText = `${Math.floor(data.mHp).toLocaleString()} / ${data.maxHp.toLocaleString()}`;
        
        const artGrid = document.getElementById('artis-info');
        artGrid.innerHTML = '';
        [1,2,3].forEach(i => artGrid.innerHTML += `<div class="stat-box"><small>ARTIFACT</small>Lv.${data.artis[i]}</div>`);
        save();
    };

    return {
        start: () => {
            const id = document.getElementById('join-id').value.trim();
            if(!id) return alert("ENTER NICKNAME");
            user = id;
            const saved = JSON.parse(localStorage.getItem('mo_final_db') || "{}");
            if(saved[id]) data = saved[id];
            
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            
            updateUI();
            setInterval(() => {
                if(autoTime > 0) { Engine.doDamage(getAtk() * 0.5); autoTime--; }
                Engine.doDamage(getAtk() * 0.05, true);
                updateUI();
            }, 1000);
        },

        clickHit: () => {
            Engine.doDamage(getAtk());
            const m = document.getElementById('monster-icon');
            m.style.transform = "scale(0.8) translateY(10px)";
            setTimeout(() => m.style.transform = "scale(1)", 50);
            
            const pop = document.createElement('div');
            pop.className = 'damage-pop';
            pop.innerText = `-${Math.floor(getAtk()).toLocaleString()}`;
            pop.style.left = (Math.random()*40+30) + "%";
            pop.style.top = "40%";
            document.getElementById('battle-screen').appendChild(pop);
            setTimeout(() => pop.remove(), 500);
        },

        doDamage: (dmg, isPassive) => {
            data.mHp -= dmg;
            if(data.mHp <= 0) {
                data.gold += (500 * data.stage) * (1 + data.artis[2]);
                if(Math.random() < 0.1) {
                    data.artis[Math.floor(Math.random()*3)+1]++;
                    showToast("üè∫ Artifact Resonance!");
                }
                data.stage++;
                data.maxHp = Math.floor(2000 * Math.pow(1.25, data.stage));
                data.mHp = data.maxHp;
                document.getElementById('monster-icon').innerText = MONSTERS[data.stage % MONSTERS.length];
                showToast("STAGE CLEAR!");
            }
            if(!isPassive) updateUI();
        },

        summon: () => {
            if(data.dia < 1000) return showToast("No Diamond!");
            data.dia -= 1000;
            const res = document.getElementById('draw-result');
            res.innerHTML = '';
            for(let i=0; i<10; i++) {
                const pick = HERO_DB[Math.floor(Math.random() * HERO_DB.length)];
                data.inv.push({...pick, uid: Date.now() + Math.random(), star: 1});
                if(!data.book.includes(pick.id)) data.book.push(pick.id);
                res.innerHTML += `<div class="card-img">${pick.emoji}</div>`;
            }
            updateUI();
        },

        autoMerge: () => {
            let evolved = false;
            let groups = {};
            data.inv.forEach(h => { if(!groups[h.id]) groups[h.id] = []; groups[h.id].push(h); });
            for(let id in groups) {
                while(groups[id].length >= 2) {
                    const h1 = groups[id].pop(); const h2 = groups[id].pop();
                    h1.star++;
                    data.inv = data.inv.filter(x => x.uid !== h2.uid);
                    evolved = true;
                }
            }
            if(evolved) { showToast("Evolved!"); Engine.renderHero(); updateUI(); }
        },

        plunder: () => {
            const target = document.getElementById('target-id').value.trim();
            const all = JSON.parse(localStorage.getItem('mo_final_db') || "{}");
            if(!all[target] || target === user) return showToast("Invalid Target");
            
            if(getAtk() > (all[target].stage * 15000)) {
                const steal = Math.floor(all[target].gold * 0.1);
                data.gold += steal;
                all[target].gold -= steal;
                localStorage.setItem('mo_final_db', JSON.stringify(all));
                showToast(`Success! Stole ${steal} Gold`);
            } else {
                showToast("Defeat! Too strong.");
            }
            updateUI();
        },

        renderHero: () => {
            const list = document.getElementById('hero-list');
            list.innerHTML = '';
            data.inv.sort((a,b) => (b.atk*b.star)-(a.atk*a.star)).forEach(h => {
                list.innerHTML += `<div class="card ${h.grade}"><div class="card-img">${h.emoji}</div><div class="card-info"><b>${h.name} ‚òÖ${h.star}</b><small>Power: ${Math.floor(h.atk*h.star).toLocaleString()}</small></div></div>`;
            });
            document.getElementById('txt-hcount').innerText = data.inv.length;
        },

        renderRank: () => {
            const all = JSON.parse(localStorage.getItem('mo_final_db') || "{}");
            const sorted = Object.keys(all).map(k => ({id:k, s:all[k].stage})).sort((a,b)=>b.s-a.s);
            document.getElementById('rank-list').innerHTML = sorted.slice(0,5).map((u,i)=>`<div class="stat-box" style="text-align:left; margin-bottom:5px; padding:10px;">${i+1}. <b>${u.id}</b> - Stage ${u.s}</div>`).join('');
        },

        buy: (type) => {
            if(type === 'auto' && data.gold >= 3000) { data.gold -= 3000; autoTime += 30; }
            else if(type === 'dia' && data.gold >= 10000) { data.gold -= 10000; data.dia += 100; }
            else return showToast("Lack of Gold");
            updateUI();
        },

        tab: (name, el) => {
            document.querySelectorAll('.main-content > div').forEach(d => d.classList.add('hidden'));
            document.getElementById(`tab-${name}`).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            if(name === 'hero') Engine.renderHero();
            if(name === 'rank') Engine.renderRank();
        }
    };
})();
</script>
</body>
</html>
