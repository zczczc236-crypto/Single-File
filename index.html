<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mythic Warlord: Genesis</title>
    <style>
        :root {
            --ssr: #ffcc00; --sr: #c154ff; --r: #00d2ff; --uc: #1eff00; --fail: #555;
            --gold: #ffd700; --dia: #00f2ff; --bg: #05050a;
        }

        body {
            margin: 0; background: var(--bg); color: white;
            font-family: 'Pretendard', sans-serif;
            display: flex; justify-content: center; height: 100vh; overflow: hidden;
        }

        #app {
            width: 100%; max-width: 480px; display: flex; flex-direction: column;
            background: radial-gradient(circle at top, #1a1a2e 0%, #05050a 100%);
            position: relative; box-shadow: 0 0 100px #000; height: 100%;
        }

        /* ìƒë‹¨ ìŠ¤í…Œì´í„°ìŠ¤ */
        .status-bar {
            padding: 15px; background: rgba(0, 0, 0, 0.9);
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
            border-bottom: 2px solid #333; z-index: 100;
        }
        .stat-card { background: rgba(255,255,255,0.05); padding: 8px; border-radius: 12px; font-size: 0.85rem; font-weight: bold; text-align: center; border: 1px solid #444; }

        /* ì»¨í…ì¸  ì˜ì—­ */
        .content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 120px; scrollbar-width: none; }
        .content::-webkit-scrollbar { display: none; }

        /* ì „íˆ¬ ì‹œìŠ¤í…œ UI */
        .battle-view {
            background: rgba(0,0,0,0.6); border: 2px solid #444; border-radius: 24px;
            padding: 20px; text-align: center; position: relative; overflow: hidden;
            margin-bottom: 20px;
        }
        .monster-box { height: 180px; display: flex; align-items: center; justify-content: center; position: relative; }
        .monster-img { font-size: 6rem; transition: 0.1s; z-index: 5; }
        .hp-container { margin: 15px 0; }
        .hp-bar { height: 14px; background: #222; border-radius: 7px; overflow: hidden; border: 1px solid #555; }
        .hp-fill { height: 100%; background: linear-gradient(90deg, #ff4757, #ff6b81); width: 100%; transition: 0.1s; }
        
        /* ìŠ¤í‚¬/ë°ë¯¸ì§€ ì´í™íŠ¸ */
        .dmg-text {
            position: absolute; color: #fff; font-weight: 900; font-size: 1.5rem;
            pointer-events: none; animation: floatUp 0.8s ease-out forwards; z-index: 20;
            text-shadow: 2px 2px 0 #000;
        }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-100px); opacity: 0; } }

        /* ì¹´ë“œ ë° ê°€ì°¨ */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .card { 
            background: #111; border-radius: 15px; border: 2px solid #333; overflow: hidden; 
            position: relative; animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .card img { width: 100%; height: 120px; object-fit: cover; }
        .card-info { padding: 8px; text-align: center; font-size: 0.75rem; }
        .rank-badge { position: absolute; top: 5px; left: 5px; background: rgba(0,0,0,0.7); padding: 2px 6px; border-radius: 4px; font-size: 0.6rem; color: var(--dia); }

        /* ëŒ€ì¥ê°„ & ì§„í™” */
        .menu-box { background: rgba(255,255,255,0.03); border: 1px solid #444; border-radius: 20px; padding: 20px; text-align: center; margin-bottom: 20px; }
        
        /* ë„ê° ê·¸ë¦¬ë“œ */
        .col-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
        .col-slot { aspect-ratio: 1/1; background: #111; border-radius: 5px; border: 1px solid #333; overflow: hidden; }
        .col-slot img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(1) brightness(0.3); }
        .col-slot.owned img { filter: grayscale(0) brightness(1); }

        /* í•˜ë‹¨ ë„¤ë¹„ */
        .nav { position: absolute; bottom: 0; width: 100%; height: 80px; display: flex; background: #0a0a0f; border-top: 2px solid #333; z-index: 200; }
        .nav-btn { flex: 1; border: none; background: none; color: #555; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold; }
        .nav-btn.active { color: var(--dia); }
        .nav-btn i { font-size: 1.5rem; margin-bottom: 4px; }

        /* ë²„íŠ¼ ê³µí†µ */
        .btn { border: none; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.2s; color: white; }
        .btn-p { background: linear-gradient(135deg, #ff416c, #ff4b2b); width: 100%; padding: 15px; font-size: 1rem; }
        .btn-g { background: #333; width: 100%; padding: 15px; margin-bottom: 8px; }
        .btn-s { background: var(--gold); color: black; padding: 5px 10px; font-size: 0.7rem; border-radius: 5px; }

        .hidden { display: none; }
        #toast { position: fixed; top: 15%; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.9); padding: 12px 25px; border-radius: 30px; border: 1px solid var(--ssr); z-index: 1000; opacity: 0; transition: 0.3s; pointer-events: none; text-align: center; }
    </style>
</head>
<body>

<div id="toast">ì•Œë¦¼</div>

<div id="app">
    <div class="status-bar">
        <div class="stat-card" style="color:var(--dia)">ğŸ’ <span id="val-dia">0</span></div>
        <div class="stat-card" style="color:var(--gold)">ğŸ’° <span id="val-gold">0</span></div>
    </div>

    <div class="content">
        <div id="tab-battle">
            <h3 style="text-align:center;">âš”ï¸ ì›”ë“œ ë³´ìŠ¤ ë ˆì´ë“œ</h3>
            <div class="battle-view" id="battle-area">
                <div style="font-size: 0.8rem; color: var(--ssr); font-weight: bold;">STAGE <span id="cur-stage">1</span></div>
                <div class="monster-box">
                    <div class="monster-img" id="monster-icon">ğŸ‰</div>
                </div>
                <div class="hp-container">
                    <div class="hp-bar"><div id="hp-fill" class="hp-fill"></div></div>
                </div>
                <div style="font-size: 0.7rem; color: #888;">ì´ˆë‹¹ ìë™ ë°ë¯¸ì§€: <span id="val-dps">0</span></div>
                <button class="btn btn-p" style="margin-top:15px;" onclick="clickAttack()">í™”ë ¥ ì§‘ì¤‘ (CLICK)</button>
            </div>
        </div>

        <div id="tab-draw" class="hidden">
            <h3 style="text-align:center;">ğŸ”® ì°¨ì›ì˜ ì œë‹¨</h3>
            <div id="draw-area" class="grid" style="margin-bottom:15px;"></div>
            <button class="btn btn-g" onclick="summon(1)">1íšŒ ì†Œí™˜ (100ğŸ’)</button>
            <button class="btn btn-p" onclick="summon(10)">10íšŒ ì—°ì† ì†Œí™˜ (1,000ğŸ’)</button>
        </div>

        <div id="tab-manage">
            <div class="menu-box">
                <h4 style="margin:0 0 10px 0; color:var(--gold);">ğŸ”¨ ì „ì„¤ì˜ ëŒ€ì¥ê°„</h4>
                <div style="font-size: 0.9rem; margin-bottom:10px;">ë¬´ê¸° ë ˆë²¨: <span id="val-wp" style="color:var(--ssr)">+0</span></div>
                <button class="btn btn-s" onclick="upgradeWeapon()">ê°•í™”í•˜ê¸° (<span id="wp-cost">500</span>ğŸ’°)</button>
            </div>

            <h4 style="margin:10px 0;">ğŸ“– ì˜ì›… ë„ê° (<span id="col-count">0</span>/50)</h4>
            <div id="col-grid" class="col-grid" style="margin-bottom:20px;"></div>

            <h4 style="margin:10px 0;">âš”ï¸ ë³´ìœ  êµ°ë‹¨</h4>
            <div id="inv-list"></div>
        </div>
    </div>

    <nav class="nav">
        <button class="nav-btn active" onclick="nav('battle')"><i>âš”ï¸</i>ì „íˆ¬</button>
        <button class="nav-btn" onclick="nav('draw')"><i>ğŸ”®</i>ì†Œí™˜</button>
        <button class="nav-btn" onclick="nav('manage')"><i>ğŸ‘¤</i>ê´€ë¦¬</button>
    </nav>
</div>

<script>
    /* --- ì˜ì›… ë°ì´í„°ë² ì´ìŠ¤ (50ì¢… í™•ì¥) --- */
    const NAMES = ["ê°€ë””ì–¸", "ìŠ¬ë ˆì´ì–´", "ìœ„ì €ë“œ", "ë¡œê·¸", "í•˜ì´ì—˜í”„", "ë“œë˜ê³¤ë‚˜ì´íŠ¸", "ë°œí‚¤ë¦¬", "ë¦¬ì¹˜", "íƒ€ì´íƒ„", "ì—”ì ¤"];
    const GRADES = ["R", "SR", "SSR", "MYTHIC"];
    const HERO_DB = [];

    for(let i=1; i<=50; i++) {
        let g = i > 45 ? "MYTHIC" : (i > 35 ? "SSR" : (i > 15 ? "SR" : "R"));
        HERO_DB.push({
            id: i,
            name: `${NAMES[i%10]} #0${i}`,
            grade: g,
            atk: (i * 20) + (g === "MYTHIC" ? 5000 : (g === "SSR" ? 1000 : 100)),
            price: i * 50 + (g === "SSR" ? 5000 : 500),
            img: `https://loremflickr.com/200/200/hero,fantasy?sig=${i}`
        });
    }

    /* --- ê²Œì„ ìƒíƒœ --- */
    let game = JSON.parse(localStorage.getItem('mythic_warlord_final')) || {
        dia: 2000, gold: 0, wp: 0, stage: 1, inv: [], col: [], mHp: 1000, maxHp: 1000
    };

    function msg(m) {
        const t = document.getElementById('toast');
        t.innerText = m; t.style.opacity = 1;
        setTimeout(() => t.style.opacity = 0, 1500);
    }

    /* --- ì „íˆ¬ ì‹œìŠ¤í…œ --- */
    function calcDmg() {
        let heroAtk = game.inv.reduce((s, h) => s + (h.atk * (h.star || 1)), 0);
        let wpAtk = game.wp * 300;
        return Math.max(10, heroAtk + wpAtk);
    }

    function clickAttack() {
        spawnDmg(calcDmg() * 2);
        hit(calcDmg() * 2);
    }

    function spawnDmg(d) {
        const area = document.getElementById('battle-area');
        const text = document.createElement('div');
        text.className = 'dmg-text';
        text.innerText = `-${Math.floor(d)}`;
        text.style.left = (40 + Math.random() * 20) + '%';
        area.appendChild(text);
        setTimeout(() => text.remove(), 800);
        
        const img = document.getElementById('monster-icon');
        img.style.transform = 'scale(0.9) rotate(5deg)';
        setTimeout(() => img.style.transform = 'scale(1) rotate(0)', 100);
    }

    function hit(d) {
        game.mHp -= d;
        if(game.mHp <= 0) {
            let reward = game.stage * 1500;
            game.gold += reward;
            game.stage++;
            game.maxHp = game.stage * 3000;
            game.mHp = game.maxHp;
            msg(`ë³´ìŠ¤ ì²˜ì¹˜! +${reward}ğŸ’° íšë“`);
            updateMonster();
        }
        updateUI();
    }

    setInterval(() => hit(calcDmg() / 10), 100); // 0.1ì´ˆë§ˆë‹¤ ìë™ ê³µê²©

    /* --- ê°€ì°¨ ì‹œìŠ¤í…œ (ê½ ì¶”ê°€) --- */
    function summon(n) {
        if(game.dia < n*100) return msg("ë‹¤ì´ì•„ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
        game.dia -= n*100;
        const area = document.getElementById('draw-area');
        area.innerHTML = '';

        for(let i=0; i<n; i++) {
            setTimeout(() => {
                const r = Math.random() * 100;
                let pick = null;
                if(r < 15) { // 15% ê½
                    pick = { id: -1, name: "ë¶€ì„œì§„ ëŒë§¹ì´", grade: "FAIL", img: "https://loremflickr.com/200/200/stone" };
                } else {
                    const gr = Math.random() * 100;
                    const pool = gr < 2 ? HERO_DB.filter(h=>h.grade==='MYTHIC') : (gr < 8 ? HERO_DB.filter(h=>h.grade==='SSR') : (gr < 30 ? HERO_DB.filter(h=>h.grade==='SR') : HERO_DB.filter(h=>h.grade==='R')));
                    pick = pool[Math.floor(Math.random() * pool.length)];
                    addHero(pick);
                }
                const card = document.createElement('div');
                card.className = `card ${pick.grade === 'FAIL' ? 'fail' : ''}`;
                card.innerHTML = `<img src="${pick.img}"><div class="card-info"><b style="color:var(--${pick.grade.toLowerCase()})">${pick.name}</b></div>`;
                area.appendChild(card);
                updateUI(); save();
            }, i * 100);
        }
    }

    function addHero(h) {
        game.inv.push({...h, uid: Date.now() + Math.random(), star: 1});
        if(!game.col.includes(h.id)) game.col.push(h.id);
    }

    /* --- ê°•í™” ë° ì§„í™”(í•©ì„±) --- */
    function upgradeWeapon() {
        const cost = 500 + (game.wp * 600);
        if(game.gold < cost) return msg("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
        game.gold -= cost;
        
        const chance = Math.max(100 - (game.wp * 8), 5);
        if(Math.random() * 100 <= chance) {
            game.wp++;
            msg(`âœ¨ ê°•í™” ì„±ê³µ! (+${game.wp})`);
        } else {
            game.wp = Math.max(0, game.wp - 1);
            msg("ğŸ’¥ ê°•í™” ì‹¤íŒ¨! ë‹¨ê³„ê°€ í•˜ë½í–ˆìŠµë‹ˆë‹¤.");
        }
        updateUI(); save();
    }

    // ë™ì¼ ì˜ì›… í•©ì„± (ì§„í™”)
    function evolve(id) {
        const targets = game.inv.filter(h => h.id === id);
        if(targets.length < 2) return msg("ì§„í™”í•˜ë ¤ë©´ ë™ì¼í•œ ì˜ì›…ì´ 2ëª… í•„ìš”í•©ë‹ˆë‹¤.");
        
        // ë‘ ëª… ì œê±°í•˜ê³  í•˜ë‚˜ë¥¼ ì§„í™”ëœ ìƒíƒœë¡œ ì¶”ê°€
        let idx1 = game.inv.findIndex(h => h.id === id);
        game.inv.splice(idx1, 1);
        let idx2 = game.inv.findIndex(h => h.id === id);
        let base = game.inv[idx2];
        base.star = (base.star || 1) + 1;
        base.atk *= 1.5;
        base.price *= 2;
        
        msg(`â­ ì§„í™” ì„±ê³µ! [${base.name}] ${base.star}ì„± ë‹¬ì„±!`);
        nav('manage'); updateUI(); save();
    }

    /* --- ì‹œìŠ¤í…œ UI --- */
    function nav(t) {
        document.querySelectorAll('.content > div').forEach(d => d.classList.add('hidden'));
        document.getElementById('tab-' + t).classList.remove('hidden');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        event.currentTarget.classList.add('active');
        if(t === 'manage') { renderCol(); renderInv(); }
    }

    function renderCol() {
        const grid = document.getElementById('col-grid'); grid.innerHTML = '';
        HERO_DB.forEach(h => {
            const owned = game.col.includes(h.id);
            grid.innerHTML += `<div class="col-slot ${owned?'owned':''}"><img src="${h.img}"></div>`;
        });
        document.getElementById('col-count').innerText = game.col.length;
    }

    function renderInv() {
        const list = document.getElementById('inv-list'); list.innerHTML = '';
        // íŒë§¤ê°€ëŠ” ê°•í™”ë ˆë²¨ì— ë¹„ë¡€í•´ ìƒìŠ¹
        game.inv.forEach((h, idx) => {
            const sellPrice = Math.floor(h.price * (1 + game.wp * 0.25));
            const div = document.createElement('div');
            div.style = "display:flex; align-items:center; background:rgba(255,255,255,0.05); margin-bottom:8px; padding:12px; border-radius:12px; border:1px solid #333;";
            div.innerHTML = `
                <img src="${h.img}" style="width:45px; height:45px; border-radius:8px; margin-right:12px;">
                <div style="flex:1; font-size:0.8rem;">
                    <b style="color:var(--${h.grade.toLowerCase()})">${h.name}</b> <span style="color:var(--gold)">â˜…${h.star}</span><br>
                    ê³µê²©ë ¥: ${Math.floor(h.atk * h.star)} | ê°€ì¹˜: ${sellPrice.toLocaleString()}ğŸ’°
                </div>
                <button class="btn btn-s" onclick="evolve(${h.id})" style="background:#555; margin-right:5px;">í•©ì„±</button>
                <button class="btn btn-s" onclick="sellHero(${idx})" style="background:#f44; color:white;">íŒë§¤</button>
            `;
            list.appendChild(div);
        });
    }

    function sellHero(idx) {
        const sellPrice = Math.floor(game.inv[idx].price * (1 + game.wp * 0.25));
        game.gold += sellPrice;
        game.inv.splice(idx, 1);
        renderInv(); updateUI(); save();
    }

    function updateMonster() {
        const icons = ["ğŸ‰", "ğŸ™", "ğŸ§™", "ğŸ§›", "ğŸ§Ÿ", "ğŸ¤–"];
        document.getElementById('monster-icon').innerText = icons[game.stage % icons.length];
    }

    function updateUI() {
        document.getElementById('val-dia').innerText = game.dia.toLocaleString();
        document.getElementById('val-gold').innerText = game.gold.toLocaleString();
        document.getElementById('hp-fill').style.width = (game.mHp / game.maxHp * 100) + '%';
        document.getElementById('cur-stage').innerText = game.stage;
        document.getElementById('val-dps').innerText = Math.floor(calcDmg()).toLocaleString();
        document.getElementById('val-wp').innerText = `+${game.wp}`;
        document.getElementById('wp-cost').innerText = (500 + (game.wp * 600)).toLocaleString();
    }

    function save() { localStorage.setItem('mythic_warlord_final', JSON.stringify(game)); }

    // ì´ˆê¸° ì‹¤í–‰
    updateUI();
    updateMonster();
</script>
</body>
</html>
