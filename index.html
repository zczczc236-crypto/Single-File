<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mythic Gacha Master: Masterpiece</title>
    <style>
        :root {
            --ssr: #ffcc00; --sr: #c154ff; --r: #00d2ff;
            --gold: #ffd700; --dia: #00f2ff; --bg: #05050a;
        }

        body {
            margin: 0; background: var(--bg); color: white;
            font-family: 'Pretendard', sans-serif; overflow: hidden;
            display: flex; justify-content: center; height: 100vh;
        }

        #app {
            width: 100%; max-width: 450px; display: flex; flex-direction: column;
            background: linear-gradient(180deg, #111 0%, #000 100%);
            position: relative; box-shadow: 0 0 100px rgba(0,242,255,0.1);
        }

        /* ìƒë‹¨ ë°”: ìì› ë° ë ˆë²¨ */
        .status-bar {
            padding: 15px; background: rgba(255,255,255,0.05);
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
            border-bottom: 1px solid #333; backdrop-filter: blur(10px);
        }
        .stat-item { background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 10px; font-size: 0.85rem; font-weight: bold; }
        .lv-bar { grid-column: 1 / -1; height: 4px; background: #333; border-radius: 2px; margin-top: 5px; overflow: hidden; }
        .lv-progress { height: 100%; background: var(--dia); width: 0%; transition: 0.3s; }

        /* ë©”ì¸ ì»¨í…ì¸  êµ¬ì—­ */
        .content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; scrollbar-width: none; }
        .content::-webkit-scrollbar { display: none; }

        /* ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜ */
        .card-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 20px; }
        .card {
            background: #1a1a1a; border-radius: 15px; border: 2px solid #333;
            overflow: hidden; position: relative; animation: cardIn 0.5s ease-out forwards;
        }
        @keyframes cardIn { from { transform: scale(0.5) translateY(30px); opacity: 0; } to { transform: scale(1) translateY(0); opacity: 1; } }
        .card img { width: 100%; height: 140px; object-fit: cover; }
        .card-grade { position: absolute; top: 5px; left: 5px; font-size: 10px; padding: 2px 6px; border-radius: 5px; font-weight: 900; }

        /* ë„ê° ìŠ¤íƒ€ì¼ */
        .collection-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .col-item { aspect-ratio: 1/1; border-radius: 8px; border: 1px solid #333; position: relative; overflow: hidden; }
        .col-item.locked { filter: grayscale(1) brightness(0.3); }
        .col-item img { width: 100%; height: 100%; object-fit: cover; }

        /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .nav {
            position: absolute; bottom: 0; width: 100%; height: 70px;
            display: flex; background: rgba(10, 10, 15, 0.95); border-top: 1px solid #333;
        }
        .nav-btn { flex: 1; border: none; background: none; color: #666; cursor: pointer; font-size: 0.75rem; transition: 0.3s; }
        .nav-btn.active { color: var(--dia); font-weight: bold; }

        /* ê³µí†µ ë²„íŠ¼ */
        .btn { border: none; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-draw { width: 100%; padding: 15px; margin-top: 10px; font-size: 1rem; }
        .btn-1 { background: #333; color: white; }
        .btn-10 { background: linear-gradient(90deg, #ff4b2b, #ff416c); color: white; box-shadow: 0 5px 15px rgba(255, 65, 108, 0.3); }

        .title-display { text-align: center; margin-bottom: 20px; }
        .title-badge { color: var(--ssr); font-size: 0.9rem; border: 1px solid var(--ssr); padding: 2px 10px; border-radius: 20px; }

        .hidden { display: none; }
        .shake { animation: shake 0.4s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
    </style>
</head>
<body>

<div id="app">
    <div class="status-bar">
        <div class="stat-item" style="color:var(--dia)">ğŸ’ <span id="dia">2,000</span></div>
        <div class="stat-item" style="color:var(--gold)">ğŸ’° <span id="gold">0</span></div>
        <div class="stat-item" style="grid-column: span 2;">Lv.<span id="lv">1</span> <small>(EXP: <span id="exp">0</span>%)</small>
            <div class="lv-bar"><div id="lv-prog" class="lv-progress"></div></div>
        </div>
    </div>

    <div class="content" id="main-content">
        <div id="tab-draw">
            <div class="title-display"><span id="user-title" class="title-badge">ì´ˆë³´ ì†Œí™˜ì‚¬</span></div>
            <div id="draw-result" class="card-grid">
                <p style="grid-column: span 2; text-align: center; opacity: 0.5; margin-top: 50px;">ì‹ í™” ì† ì˜ì›…ì„ ë¶ˆëŸ¬ë‚´ì„¸ìš”.</p>
            </div>
            <div style="margin-top: 20px;">
                <button class="btn btn-draw btn-1" onclick="gacha(1)">1íšŒ ì†Œí™˜ (100ğŸ’)</button>
                <button class="btn btn-draw btn-10" onclick="gacha(10)">10íšŒ ì—°ì† ì†Œí™˜ (1,000ğŸ’)</button>
            </div>
        </div>

        <div id="tab-inv" class="hidden">
            <h3>ë‚´ êµ°ë‹¨ (<span id="inv-count">0</span>)</h3>
            <div id="inv-list"></div>
        </div>

        <div id="tab-col" class="hidden">
            <h3>ì˜ì›… ë„ê° (<span id="col-count">0</span>/12)</h3>
            <div id="col-grid" class="collection-grid"></div>
        </div>

        <div id="tab-shop" class="hidden">
            <h3>ì°¨ì› ìƒì </h3>
            <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:15px;">
                <p>ğŸ’° ê³¨ë“œë¥¼ ë‹¤ì´ì•„ë¡œ ì—°ì„±í•©ë‹ˆë‹¤.</p>
                <button class="btn btn-1" style="width:100%; margin-bottom:10px;" onclick="exchange(1000, 5000)">1,000ğŸ’ êµí™˜ (5,000ğŸ’°)</button>
                <button class="btn btn-10" style="width:100%;" onclick="exchange(5000, 20000)">5,500ğŸ’ êµí™˜ (20,000ğŸ’°)</button>
            </div>
        </div>
    </div>

    <nav class="nav">
        <button class="nav-btn active" onclick="nav('draw')">ğŸ  ì†Œí™˜</button>
        <button class="nav-btn" onclick="nav('inv')">âš”ï¸ êµ°ë‹¨</button>
        <button class="nav-btn" onclick="nav('col')">ğŸ“– ë„ê°</button>
        <button class="nav-btn" onclick="nav('shop')">ğŸ’ ìƒì </button>
    </nav>
</div>

<script>
    /* --- ì•„ì´í…œ ë° ì‹œìŠ¤í…œ ë°ì´í„° --- */
    const db = [
        {id:0, name:"ë£¨ì‹œí¼", grade:"SSR", price:10000, img:"https://loremflickr.com/300/400/demon"},
        {id:1, name:"ê°€ë¸Œë¦¬ì—˜", grade:"SSR", price:10000, img:"https://loremflickr.com/300/400/angel"},
        {id:2, name:"ë°”í•˜ë¬´íŠ¸", grade:"SSR", price:9000, img:"https://loremflickr.com/300/400/dragon"},
        {id:3, name:"ì•„í…Œë‚˜", grade:"SR", price:3000, img:"https://loremflickr.com/300/400/woman,warrior"},
        {id:4, name:"ì˜¤ë”˜", grade:"SR", price:3000, img:"https://loremflickr.com/300/400/king"},
        {id:5, name:"ì•„ì„œ", grade:"SR", price:2500, img:"https://loremflickr.com/300/400/knight"},
        {id:6, name:"ë©€ë¦°", grade:"SR", price:2500, img:"https://loremflickr.com/300/400/wizard"},
        {id:7, name:"í˜ê°€ìˆ˜ìŠ¤", grade:"R", price:1000, img:"https://loremflickr.com/300/400/horse"},
        {id:8, name:"ë¯¸ë…¸íƒ€ìš°ë¥´ìŠ¤", grade:"R", price:900, img:"https://loremflickr.com/300/400/monster"},
        {id:9, name:"ì¼„íƒ€ìš°ë¡œìŠ¤", grade:"R", price:900, img:"https://loremflickr.com/300/400/archer"},
        {id:10, name:"í•´ê³¨ë³‘ì‚¬", grade:"R", price:800, img:"https://loremflickr.com/300/400/skeleton"},
        {id:11, name:"ìŠ¬ë¼ì„", grade:"R", price:700, img:"https://loremflickr.com/300/400/slime"}
    ];

    let user = JSON.parse(localStorage.getItem('mythic_vfinal')) || {
        dia: 2000, gold: 0, exp: 0, lv: 1,
        inv: [], col: []
    };

    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    function sfx(f, d, t='sine') {
        const o = ctx.createOscillator(); const g = ctx.createGain();
        o.type = t; o.frequency.value = f; g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime+d);
        o.connect(g); g.connect(ctx.destination); o.start(); o.stop(ctx.currentTime+d);
    }

    /* --- ë‚´ë¹„ê²Œì´ì…˜ --- */
    function nav(t) {
        document.querySelectorAll('.content > div').forEach(d => d.classList.add('hidden'));
        document.getElementById('tab-'+t).classList.remove('hidden');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        event.currentTarget.classList.add('active');
        if(t === 'inv') renderInv();
        if(t === 'col') renderCol();
    }

    /* --- í•µì‹¬ ë¡œì§ --- */
    function gacha(n) {
        if(user.dia < n*100) return alert("ë‹¤ì´ì•„ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
        user.dia -= n*100;
        const resDiv = document.getElementById('draw-result');
        resDiv.innerHTML = '';
        
        for(let i=0; i<n; i++) {
            setTimeout(() => {
                const item = pull();
                user.inv.push({...item, uid: Math.random()});
                if(!user.col.includes(item.id)) user.col.push(item.id);
                
                // ê²½í—˜ì¹˜ ë° ì¹­í˜¸ ì²´í¬
                user.exp += (item.grade === 'SSR' ? 20 : (item.grade === 'SR' ? 10 : 5));
                if(user.exp >= 100) { user.lv++; user.exp = 0; sfx(880, 0.5, 'square'); }
                
                renderCard(item, resDiv);
                if(item.grade === 'SSR') { sfx(1200, 0.6, 'square'); document.getElementById('app').classList.add('shake'); setTimeout(()=>document.getElementById('app').classList.remove('shake'), 400); }
                else sfx(440, 0.1);
                
                save(); updateUI();
            }, i * 150);
        }
    }

    function pull() {
        const r = Math.random() * 100;
        const gradePool = r < 5 ? 'SSR' : (r < 25 ? 'SR' : 'R');
        const items = db.filter(i => i.grade === gradePool);
        return items[Math.floor(Math.random()*items.length)];
    }

    function renderCard(item, target) {
        const d = document.createElement('div');
        d.className = 'card'; d.style.borderColor = `var(--${item.grade.toLowerCase()})`;
        d.innerHTML = `<span class="card-grade" style="background:var(--${item.grade.toLowerCase()})">${item.grade}</span><img src="${item.img}?sig=${Math.random()}"><div style="padding:8px; font-size:12px; text-align:center;">${item.name}</div>`;
        target.appendChild(d);
    }

    /* --- ì¸ë²¤í† ë¦¬ ë° ë„ê° --- */
    function renderInv() {
        const list = document.getElementById('inv-list');
        list.innerHTML = '';
        document.getElementById('inv-count').innerText = user.inv.length;
        user.inv.forEach((item, idx) => {
            const row = document.createElement('div');
            row.style = "display:flex; align-items:center; background:#222; margin-bottom:10px; padding:10px; border-radius:10px;";
            row.innerHTML = `<img src="${item.img}" style="width:40px; height:40px; border-radius:5px; margin-right:10px;">
                <div style="flex:1; font-size:13px;"><b style="color:var(--${item.grade.toLowerCase()})">${item.name}</b><br><small>${item.price}ğŸ’°</small></div>
                <button class="btn btn-1" style="padding:5px 10px;" onclick="sell(${idx})">íŒë§¤</button>`;
            list.appendChild(row);
        });
    }

    function renderCol() {
        const grid = document.getElementById('col-grid');
        grid.innerHTML = '';
        document.getElementById('col-count').innerText = user.col.length;
        db.forEach(item => {
            const locked = !user.col.includes(item.id);
            const div = document.createElement('div');
            div.className = `col-item ${locked ? 'locked' : ''}`;
            div.innerHTML = `<img src="${item.img}">`;
            grid.appendChild(div);
        });
    }

    function sell(idx) {
        user.gold += user.inv[idx].price;
        user.inv.splice(idx, 1);
        save(); updateUI(); renderInv();
        sfx(600, 0.1);
    }

    function exchange(d, g) {
        if(user.gold < g) return alert("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
        user.gold -= g; user.dia += d;
        save(); updateUI();
        sfx(1000, 0.3);
    }

    function updateUI() {
        document.getElementById('dia').innerText = user.dia.toLocaleString();
        document.getElementById('gold').innerText = user.gold.toLocaleString();
        document.getElementById('lv').innerText = user.lv;
        document.getElementById('exp').innerText = user.exp;
        document.getElementById('lv-prog').style.width = user.exp + '%';
        
        // ì¹­í˜¸ ë¡œì§
        let title = "ì´ˆë³´ ì†Œí™˜ì‚¬";
        if(user.col.length >= 12) title = "ğŸ”± ì‹ í™”ì˜ ì •ë³µì";
        else if(user.lv >= 10) title = "ê³ ê¸‰ ë§ˆë²•ì‚¬";
        else if(user.lv >= 5) title = "ìˆ™ë ¨ëœ ëª¨í—˜ê°€";
        document.getElementById('user-title').innerText = title;
    }

    function save() { localStorage.setItem('mythic_vfinal', JSON.stringify(user)); }
    updateUI();
</script>
</body>
</html>
